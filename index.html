<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>vkMRKTos | Marketing OS by ValidKernel</title>

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="vkMRKTos">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="vkMRKTos">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#7C3AED">
    <meta name="description" content="vkMRKTos - Marketing Operating System powered by ValidKernel. 100% auditable, user-owned data, VTI‚Ñ¢ verified.">

    <!-- PWA Manifest (inline) -->
    <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22MARKTOS%20Genesis%22%2C%22short_name%22%3A%22MARKTOS%22%2C%22description%22%3A%2225-Layer%20Marketing%20Genome%20Platform%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230f0f23%22%2C%22theme_color%22%3A%22%237C3AED%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%2520viewBox%3D%270%25200%2520100%2520100%27%253E%253Crect%2520fill%3D%27%25237C3AED%27%2520width%3D%27100%27%2520height%3D%27100%27%2520rx%3D%2720%27%2F%253E%253Ctext%2520x%3D%2750%27%2520y%3D%2765%27%2520font-size%3D%2750%27%2520text-anchor%3D%27middle%27%2520fill%3D%27white%27%2520font-family%3D%27monospace%27%253EM%253C%2Ftext%253E%253C%2Fsvg%253E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kernel: { primary: '#7C3AED', secondary: '#4F46E5', accent: '#06B6D4' }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        @keyframes gradientRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .gradient-bg {
            background: linear-gradient(-45deg, #0f0f23, #1a1a3e, #2d1b4e, #1e3a5f, #0f0f23);
            background-size: 400% 400%;
            animation: gradientRotate 15s ease infinite;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glow-purple { box-shadow: 0 0 30px rgba(124, 58, 237, 0.3); }
        .glow-cyan { box-shadow: 0 0 30px rgba(6, 182, 212, 0.3); }

        .nav-section { border-left: 2px solid rgba(255,255,255,0.1); padding-left: 12px; margin-left: 8px; }
        .nav-item { transition: all 0.2s; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: rgba(124, 58, 237, 0.3); border-left: 2px solid #7C3AED; }

        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(124, 58, 237, 0.2); }

        .layer-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; }
        .layer-0-4 { background: rgba(239, 68, 68, 0.3); color: #fca5a5; }
        .layer-5-8 { background: rgba(245, 158, 11, 0.3); color: #fcd34d; }
        .layer-9-12 { background: rgba(34, 197, 94, 0.3); color: #86efac; }
        .layer-13-16 { background: rgba(59, 130, 246, 0.3); color: #93c5fd; }
        .layer-17-20 { background: rgba(168, 85, 247, 0.3); color: #d8b4fe; }
        .layer-21-25 { background: rgba(236, 72, 153, 0.3); color: #f9a8d4; }

        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: rgba(124, 58, 237, 0.5); border-radius: 4px; }

        /* View Mode Styles */
        .view-btn { color: rgba(255,255,255,0.5); }
        .view-btn:hover { color: rgba(255,255,255,0.8); background: rgba(255,255,255,0.1); }
        .view-btn.active { color: white; background: rgba(124, 58, 237, 0.5); }

        /* Collapsible Nav Groups */
        .nav-section.collapsed { display: none; }

        /* View Mode Layouts */
        .view-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .view-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .view-table { display: table; width: 100%; border-collapse: collapse; }

        /* Card View Item */
        .item-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        .item-card:hover {
            background: rgba(255,255,255,0.06);
            border-color: rgba(124, 58, 237, 0.3);
            transform: translateY(-2px);
        }

        /* List View Item */
        .item-list {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        .item-list:hover { background: rgba(255,255,255,0.05); }

        /* Table View */
        .table-header {
            display: grid;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 8px 8px 0 0;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
            font-weight: 600;
        }
        .table-row {
            display: grid;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.15s;
            cursor: pointer;
        }
        .table-row:hover { background: rgba(255,255,255,0.03); }
        .table-row:last-child { border-bottom: none; border-radius: 0 0 8px 8px; }

        /* Sortable columns */
        .sortable { cursor: pointer; user-select: none; }
        .sortable:hover { color: rgba(255,255,255,0.8); }
        .sort-asc::after { content: ' ‚Üë'; }
        .sort-desc::after { content: ' ‚Üì'; }

        /* Clean status badges */
        .status-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        .status-active { background: rgba(34, 197, 94, 0.2); color: #86efac; }
        .status-draft { background: rgba(156, 163, 175, 0.2); color: #d1d5db; }
        .status-paused { background: rgba(251, 191, 36, 0.2); color: #fcd34d; }
        .status-completed { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: rgba(255,255,255,0.4);
        }
    </style>
</head>
<body class="gradient-bg text-white min-h-screen">

    <!-- KERNEL STATUS BAR -->
    <div class="fixed top-0 left-0 right-0 h-1 bg-gradient-to-r from-purple-600 via-indigo-500 to-cyan-400 z-50"></div>

    <div class="flex min-h-screen">

        <!-- SIDEBAR -->
        <aside class="w-64 glass-dark flex flex-col fixed left-0 top-0 bottom-0 z-40 overflow-y-auto">

            <!-- LOGO -->
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-cyan-400 rounded-lg flex items-center justify-center">
                        <span class="mono text-lg"><span class="italic font-light">v</span><span class="font-bold">k</span></span>
                    </div>
                    <div>
                        <div class="mono font-bold text-lg"><span class="italic font-light text-purple-300">v</span>k<span class="text-purple-400">MRKT</span>os</div>
                        <div class="text-xs text-gray-400">v2.3 | Marketing OS</div>
                    </div>
                </div>
            </div>

            <!-- KERNEL STATUS -->
            <div class="p-4 mx-4 mt-4 glass rounded-lg">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-2 h-2 rounded-full bg-yellow-400 pulse"></div>
                    <span class="mono text-xs text-yellow-400">L0 AUTHORITY ACTIVE</span>
                </div>
                <div class="text-xs text-gray-400" id="trust-level-display">Trust Level: <span class="text-yellow-300">L0_SUPER_ADMIN</span></div>
                <div class="text-xs text-gray-400">Session: <span class="text-green-400">VALID</span></div>
            </div>

            <!-- NAVIGATION -->
            <nav class="flex-1 p-4 space-y-4 overflow-y-auto">

                <!-- DASHBOARD -->
                <div>
                    <div class="nav-item active flex items-center gap-3 p-3 rounded-lg cursor-pointer" onclick="showLayer('dashboard')">
                        <span>üìä</span>
                        <span class="text-sm font-medium">Dashboard</span>
                    </div>
                </div>

                <!-- CONTACTS & AUDIENCES -->
                <div>
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('contacts')">
                        <span class="text-purple-400">üë•</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Contacts & Audiences</span>
                        <span class="ml-auto text-gray-500 text-xs" id="contacts-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-contacts">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('identity')">
                            <span>üë§</span><span>All Contacts</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('segmentation')">
                            <span>üéØ</span><span>Segments</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('leads')">
                            <span>üß≤</span><span>Lead Capture</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('scoring')">
                            <span>üìà</span><span>Lead Scoring</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('audience')">
                            <span>üß†</span><span>Audience Insights</span>
                        </div>
                    </div>
                </div>

                <!-- CAMPAIGNS & CONTENT -->
                <div>
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('campaigns')">
                        <span class="text-blue-400">üöÄ</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Campaigns & Content</span>
                        <span class="ml-auto text-gray-500 text-xs" id="campaigns-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-campaigns">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('campaigns')">
                            <span>üöÄ</span><span>All Campaigns</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('content')">
                            <span>üìù</span><span>Email Templates</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('personalization')">
                            <span>‚ú®</span><span>Personalization</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('testing')">
                            <span>üß™</span><span>A/B Testing</span>
                        </div>
                    </div>
                </div>

                <!-- AUTOMATION & JOURNEYS -->
                <div>
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('automation')">
                        <span class="text-cyan-400">‚ö°</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Automation</span>
                        <span class="ml-auto text-gray-500 text-xs" id="automation-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-automation">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('automation')">
                            <span>‚ö°</span><span>Workflows</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('journeys')">
                            <span>üó∫Ô∏è</span><span>Customer Journeys</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('realtime')">
                            <span>‚ö°</span><span>Real-Time Triggers</span>
                        </div>
                    </div>
                </div>

                <!-- ANALYTICS & REPORTS -->
                <div>
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('analytics')">
                        <span class="text-green-400">üìä</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Analytics</span>
                        <span class="ml-auto text-gray-500 text-xs" id="analytics-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-analytics">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('analytics')">
                            <span>üìä</span><span>Reports</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('revenue')">
                            <span>üí∞</span><span>Revenue</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('experiments')">
                            <span>üî¨</span><span>Experiments</span>
                        </div>
                    </div>
                </div>

                <!-- INTEGRATIONS -->
                <div>
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('integrations')">
                        <span class="text-orange-400">üîó</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Integrations</span>
                        <span class="ml-auto text-gray-500 text-xs" id="integrations-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-integrations">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('channels')">
                            <span>üì°</span><span>Channels</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('integrations')">
                            <span>üîó</span><span>Connectors</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('deliverability')">
                            <span>üì¨</span><span>Deliverability</span>
                        </div>
                    </div>
                </div>

                <!-- COMPLIANCE & PRIVACY -->
                <div>
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('compliance')">
                        <span class="text-red-400">üîí</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Compliance</span>
                        <span class="ml-auto text-gray-500 text-xs" id="compliance-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-compliance">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('compliance')">
                            <span>üîí</span><span>Compliance Center</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('privacy')">
                            <span>üõ°Ô∏è</span><span>Privacy</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('abm')">
                            <span>üè¢</span><span>Account-Based</span>
                        </div>
                    </div>
                </div>

                <!-- TOOLS -->
                <div class="pt-4 border-t border-white/10">
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('tools')">
                        <span class="text-cyan-400">üõ†Ô∏è</span>
                        <span class="text-xs text-gray-300 uppercase tracking-wider font-medium">Tools</span>
                        <span class="ml-auto text-gray-500 text-xs" id="tools-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-tools">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showModal('export-data')">
                            <span>üì§</span><span>Export Data</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showModal('import-data')">
                            <span>üì•</span><span>Import Data</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showModal('chat-parser')">
                            <span>üí¨</span><span>Chat Parser</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showModal('share-link')">
                            <span>üîó</span><span>Share Link</span>
                        </div>
                    </div>
                </div>

                <!-- ADMIN (SUPER_ADMIN ONLY) -->
                <div class="pt-4 border-t border-white/10" id="admin-section">
                    <div class="flex items-center gap-2 mb-2 px-3 cursor-pointer" onclick="toggleNavGroup('admin')">
                        <span class="text-yellow-400">‚öôÔ∏è</span>
                        <span class="text-xs text-yellow-300 uppercase tracking-wider font-medium">Admin</span>
                        <span class="ml-auto text-gray-500 text-xs" id="admin-chevron">‚ñº</span>
                    </div>
                    <div class="nav-section space-y-1" id="nav-admin">
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-yellow-300" onclick="showModal('command-center')">
                            <span>‚ö°</span><span>Command Center</span>
                            <span id="sidebar-cmd-count" class="ml-auto text-xs mono bg-yellow-500/20 px-2 py-0.5 rounded">0</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('governance')">
                            <span>‚öôÔ∏è</span><span>Governance</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('kernel')">
                            <span>üß¨</span><span>System Monitor</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showLayer('data')">
                            <span>üíæ</span><span>Data Schema</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showModal('trust-score')">
                            <span>üõ°Ô∏è</span><span>VTI‚Ñ¢ Trust</span>
                            <span class="ml-auto text-xs mono text-green-400" id="sidebar-trust-score">--</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="showModal('audit-log')">
                            <span>üìú</span><span>Audit Log</span>
                        </div>
                        <div class="nav-item flex items-center gap-3 p-2 rounded cursor-pointer text-sm text-gray-300" onclick="exportComplianceReport()">
                            <span>üìä</span><span>Compliance Report</span>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- SIDEBAR FOOTER -->
            <div class="p-4 border-t border-white/10">
                <div class="text-xs text-gray-500 mono">
                    <div>VALIDKERNEL v1.0.0</div>
                    <div class="text-green-500">VTI‚Ñ¢ Enabled</div>
                    <div class="text-cyan-600 mt-1" id="install-hint" style="display:none;">üì± Tap to install</div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 ml-64 p-8">

            <!-- HEADER - Clean & Minimal -->
            <header class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-2xl font-semibold" id="page-title">Dashboard</h1>
                    <p class="text-gray-500 text-sm mt-0.5" id="page-subtitle">Overview of your marketing performance</p>
                </div>
                <div class="flex items-center gap-3">
                    <!-- View Mode Toggle -->
                    <div class="glass rounded-lg p-1 flex gap-1" id="view-mode-toggle">
                        <button onclick="setViewMode('cards')" class="view-btn px-3 py-1.5 rounded text-xs transition active" data-mode="cards" title="Cards View">
                            <span>‚ñ¶</span>
                        </button>
                        <button onclick="setViewMode('list')" class="view-btn px-3 py-1.5 rounded text-xs transition" data-mode="list" title="List View">
                            <span>‚ò∞</span>
                        </button>
                        <button onclick="setViewMode('table')" class="view-btn px-3 py-1.5 rounded text-xs transition" data-mode="table" title="Table View">
                            <span>‚ñ§</span>
                        </button>
                    </div>
                    <!-- Search -->
                    <div class="glass rounded-lg px-3 py-2 flex items-center gap-2">
                        <span class="text-gray-500">üîç</span>
                        <input type="text" placeholder="Search..." class="bg-transparent border-none outline-none text-sm w-32 placeholder-gray-500" id="global-search" onkeyup="handleSearch(this.value)">
                    </div>
                    <!-- Quick Actions -->
                    <button onclick="showModal('new-campaign')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm font-medium transition">
                        + New
                    </button>
                    <!-- Notifications -->
                    <button onclick="showModal('notifications')" class="glass rounded-lg p-2 hover:bg-white/10 transition relative">
                        <span class="text-gray-400">üîî</span>
                        <span id="notification-badge" class="absolute -top-1 -right-1 w-4 h-4 bg-purple-500 rounded-full text-xs flex items-center justify-center" style="display:none;">0</span>
                    </button>
                    <!-- User Avatar -->
                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center cursor-pointer hover:ring-2 ring-purple-400 transition" onclick="showModal('user-profile')">
                        <span class="text-xs font-bold" id="user-avatar-text">SA</span>
                    </div>
                </div>
            </header>

            <!-- Toolbar for filtering/sorting (shown on relevant pages) -->
            <div id="content-toolbar" class="flex items-center justify-between mb-4 hidden">
                <div class="flex items-center gap-2">
                    <select class="glass rounded-lg px-3 py-2 text-sm bg-transparent border-none outline-none" id="filter-status" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="draft">Draft</option>
                        <option value="paused">Paused</option>
                        <option value="completed">Completed</option>
                    </select>
                    <select class="glass rounded-lg px-3 py-2 text-sm bg-transparent border-none outline-none" id="filter-type" onchange="applyFilters()">
                        <option value="">All Types</option>
                        <option value="broadcast">Broadcast</option>
                        <option value="automation">Automation</option>
                        <option value="triggered">Triggered</option>
                    </select>
                </div>
                <div class="flex items-center gap-2 text-sm text-gray-400">
                    <span id="results-count">0 items</span>
                    <span>|</span>
                    <button onclick="showModal('column-settings')" class="hover:text-white transition">‚öôÔ∏è Columns</button>
                </div>
            </div>

            <!-- DASHBOARD CONTENT -->
            <div id="content-dashboard" class="layer-content">

                <!-- GENOME HEALTH -->
                <div class="grid grid-cols-5 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 stat-card transition cursor-pointer glow-purple">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-2">Total Contacts</div>
                        <div class="text-3xl font-bold mono">247,892</div>
                        <div class="text-xs text-green-400 mt-2">‚Üë 12.4% this month</div>
                    </div>
                    <div class="glass rounded-xl p-6 stat-card transition cursor-pointer">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-2">Active Campaigns</div>
                        <div class="text-3xl font-bold mono">18</div>
                        <div class="text-xs text-cyan-400 mt-2">6 sending now</div>
                    </div>
                    <div class="glass rounded-xl p-6 stat-card transition cursor-pointer">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-2">Emails Sent (30d)</div>
                        <div class="text-3xl font-bold mono">1.2M</div>
                        <div class="text-xs text-green-400 mt-2">98.2% delivered</div>
                    </div>
                    <div class="glass rounded-xl p-6 stat-card transition cursor-pointer">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-2">Pipeline Value</div>
                        <div class="text-3xl font-bold mono">$2.4M</div>
                        <div class="text-xs text-purple-400 mt-2">847 opportunities</div>
                    </div>
                    <div class="glass rounded-xl p-6 stat-card transition cursor-pointer glow-cyan">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-2">Kernel Health</div>
                        <div class="text-3xl font-bold mono text-green-400">99.9%</div>
                        <div class="text-xs text-green-400 mt-2">All systems nominal</div>
                    </div>
                </div>

                <!-- LAYER GENOME VISUALIZATION -->
                <div class="glass rounded-xl p-6 mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold mono">25-LAYER GENOME STATUS</h2>
                        <div class="text-xs text-gray-400 mono">Real-time layer health</div>
                    </div>
                    <div class="grid grid-cols-25 gap-1" id="genome-grid">
                        <!-- Generated by JS -->
                    </div>
                    <div class="flex justify-between mt-4 text-xs text-gray-500">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-1"><div class="w-3 h-3 bg-green-500 rounded"></div> Healthy</div>
                            <div class="flex items-center gap-1"><div class="w-3 h-3 bg-yellow-500 rounded"></div> Warning</div>
                            <div class="flex items-center gap-1"><div class="w-3 h-3 bg-red-500 rounded"></div> Critical</div>
                        </div>
                        <div>L0: Kernel ‚Üí L25: Economics</div>
                    </div>
                </div>

                <!-- TWO COLUMN LAYOUT -->
                <div class="grid grid-cols-2 gap-8">

                    <!-- RECENT CAMPAIGNS -->
                    <div class="glass rounded-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-bold mono">ACTIVE CAMPAIGNS</h2>
                            <button class="text-xs text-purple-400 hover:text-purple-300">View All ‚Üí</button>
                        </div>
                        <div class="space-y-4" id="campaign-list">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- LEAD PIPELINE -->
                    <div class="glass rounded-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-bold mono">LEAD PIPELINE</h2>
                            <button class="text-xs text-purple-400 hover:text-purple-300">View All ‚Üí</button>
                        </div>
                        <div class="space-y-4" id="pipeline-stages">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- AUTOMATION FLOWS -->
                <div class="glass rounded-xl p-6 mt-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold mono">AUTOMATION WORKFLOWS</h2>
                        <button class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm font-medium transition">+ New Workflow</button>
                    </div>
                    <div class="grid grid-cols-4 gap-4" id="workflow-grid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- REAL-TIME ACTIVITY -->
                <div class="glass rounded-xl p-6 mt-8">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-green-400 rounded-full pulse"></div>
                            <h2 class="text-lg font-bold mono">REAL-TIME ACTIVITY</h2>
                        </div>
                        <div class="text-xs text-gray-400 mono">Live stream</div>
                    </div>
                    <div class="space-y-2 max-h-64 overflow-y-auto" id="activity-feed">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- KERNEL MONITOR -->
            <div id="content-kernel" class="layer-content hidden">
                <div class="glass rounded-xl p-6 mb-8">
                    <h2 class="text-xl font-bold mono mb-6">L0: KERNEL INVARIANTS</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="glass-dark rounded-lg p-4">
                            <div class="mono text-sm text-purple-400 mb-2">IV.01: Trust Hierarchy</div>
                            <div class="text-xs text-gray-400">Authority flows: L0 ‚Üí L1 ‚Üí L2, NEVER upward</div>
                            <div class="mt-3 flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <span class="text-xs text-green-400">ENFORCED</span>
                            </div>
                        </div>
                        <div class="glass-dark rounded-lg p-4">
                            <div class="mono text-sm text-purple-400 mb-2">IV.02: Check-Then-Act</div>
                            <div class="text-xs text-gray-400">Every action validated before execution</div>
                            <div class="mt-3 flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <span class="text-xs text-green-400">ENFORCED</span>
                            </div>
                        </div>
                        <div class="glass-dark rounded-lg p-4">
                            <div class="mono text-sm text-purple-400 mb-2">IV.03: Deterministic Boundaries</div>
                            <div class="text-xs text-gray-400">Same input MUST produce same output</div>
                            <div class="mt-3 flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <span class="text-xs text-green-400">ENFORCED</span>
                            </div>
                        </div>
                        <div class="glass-dark rounded-lg p-4">
                            <div class="mono text-sm text-purple-400 mb-2">IV.04: Role-Based Permissions</div>
                            <div class="text-xs text-gray-400">6 roles with explicit permission matrix</div>
                            <div class="mt-3 flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <span class="text-xs text-green-400">ENFORCED</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mono mb-6">ROLE PERMISSION MATRIX</h2>
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="text-left text-gray-400 border-b border-white/10">
                                <th class="pb-3 mono">Role</th>
                                <th class="pb-3 mono">Level</th>
                                <th class="pb-3 mono">Permissions</th>
                            </tr>
                        </thead>
                        <tbody id="role-matrix">
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- CAMPAIGNS -->
            <div id="content-campaigns" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div></div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition" onclick="showModal('new-campaign')">+ Create Campaign</button>
                </div>
                <div class="glass rounded-xl p-6">
                    <div class="grid grid-cols-3 gap-6" id="all-campaigns">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- LEADS -->
            <div id="content-leads" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div></div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition" onclick="showModal('new-lead')">+ Capture Lead</button>
                </div>
                <div class="grid grid-cols-4 gap-4" id="lead-pipeline">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- AUTOMATION -->
            <div id="content-automation" class="layer-content hidden">
                <div class="glass rounded-xl p-6 mb-8">
                    <h2 class="text-xl font-bold mono mb-6">WORKFLOW BUILDER</h2>
                    <div class="glass-dark rounded-lg p-8 text-center">
                        <div class="text-6xl mb-4">‚ö°</div>
                        <div class="text-lg font-medium mb-2">Visual Workflow Canvas</div>
                        <div class="text-sm text-gray-400 mb-6">Drag and drop triggers, actions, and conditions</div>
                        <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition">Open Canvas Builder</button>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mono mb-6">WORKFLOW TEMPLATES</h2>
                    <div class="grid grid-cols-3 gap-4" id="workflow-templates">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- ANALYTICS -->
            <div id="content-analytics" class="layer-content hidden">
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6">
                        <div class="text-xs text-gray-400 uppercase mb-2">Open Rate</div>
                        <div class="text-3xl font-bold mono">32.4%</div>
                        <div class="text-xs text-green-400 mt-2">‚Üë 4.2% vs avg</div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <div class="text-xs text-gray-400 uppercase mb-2">Click Rate</div>
                        <div class="text-3xl font-bold mono">8.7%</div>
                        <div class="text-xs text-green-400 mt-2">‚Üë 1.3% vs avg</div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <div class="text-xs text-gray-400 uppercase mb-2">Conversion</div>
                        <div class="text-3xl font-bold mono">4.2%</div>
                        <div class="text-xs text-yellow-400 mt-2">‚Üí 0.1% vs avg</div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <div class="text-xs text-gray-400 uppercase mb-2">Revenue</div>
                        <div class="text-3xl font-bold mono">$847K</div>
                        <div class="text-xs text-green-400 mt-2">‚Üë 23% vs LM</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mono mb-6">ENGAGEMENT FUNNEL</h2>
                    <div class="h-64 flex items-end justify-around gap-4 px-8">
                        <div class="text-center flex-1">
                            <div class="bg-gradient-to-t from-purple-600 to-purple-400 rounded-t-lg" style="height: 200px;"></div>
                            <div class="text-xs text-gray-400 mt-2">Sent</div>
                            <div class="mono text-sm">1.2M</div>
                        </div>
                        <div class="text-center flex-1">
                            <div class="bg-gradient-to-t from-purple-600 to-purple-400 rounded-t-lg" style="height: 180px;"></div>
                            <div class="text-xs text-gray-400 mt-2">Delivered</div>
                            <div class="mono text-sm">1.18M</div>
                        </div>
                        <div class="text-center flex-1">
                            <div class="bg-gradient-to-t from-purple-600 to-purple-400 rounded-t-lg" style="height: 120px;"></div>
                            <div class="text-xs text-gray-400 mt-2">Opened</div>
                            <div class="mono text-sm">382K</div>
                        </div>
                        <div class="text-center flex-1">
                            <div class="bg-gradient-to-t from-cyan-600 to-cyan-400 rounded-t-lg" style="height: 60px;"></div>
                            <div class="text-xs text-gray-400 mt-2">Clicked</div>
                            <div class="mono text-sm">103K</div>
                        </div>
                        <div class="text-center flex-1">
                            <div class="bg-gradient-to-t from-green-600 to-green-400 rounded-t-lg" style="height: 30px;"></div>
                            <div class="text-xs text-gray-400 mt-2">Converted</div>
                            <div class="mono text-sm">50K</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GENERIC LAYER PLACEHOLDER -->
            <div id="content-generic" class="layer-content hidden">
                <div class="glass rounded-xl p-12 text-center">
                    <div class="text-6xl mb-6" id="generic-icon">üß¨</div>
                    <h2 class="text-2xl font-bold mono mb-4" id="generic-title">LAYER MODULE</h2>
                    <p class="text-gray-400 mb-8" id="generic-desc">This layer module is part of the 25-layer marketing genome.</p>
                    <div class="inline-flex items-center gap-2 px-4 py-2 glass rounded-lg">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span class="mono text-sm">KERNEL VALIDATED</span>
                    </div>
                </div>
            </div>

            <!-- L1: IDENTITY -->
            <div id="content-identity" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div class="text-sm text-gray-400">Unified contact profile management</div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition" onclick="showModal('chat-parser')">+ Import Contacts</button>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-8" id="identity-contacts">
                    <!-- Generated by JS -->
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">IDENTITY FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üë§</div>
                            <div class="text-sm font-medium">Contact Cards</div>
                            <div class="text-xs text-gray-400 mt-1">Full profile view</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üîÑ</div>
                            <div class="text-sm font-medium">Merge Duplicates</div>
                            <div class="text-xs text-gray-400 mt-1">AI-detect & merge</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üìù</div>
                            <div class="text-sm font-medium">Custom Fields</div>
                            <div class="text-xs text-gray-400 mt-1">Unlimited properties</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üìÖ</div>
                            <div class="text-sm font-medium">Activity Timeline</div>
                            <div class="text-xs text-gray-400 mt-1">All interactions</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üì•</div>
                            <div class="text-sm font-medium">Contact Import</div>
                            <div class="text-xs text-gray-400 mt-1">CSV, vCard, LinkedIn</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- L2: SEGMENTATION -->
            <div id="content-segmentation" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div class="text-sm text-gray-400">Dynamic audience building with real-time updates</div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition" onclick="showModal('new-segment')">+ Create Segment</button>
                </div>
                <div class="grid grid-cols-3 gap-4 mb-8" id="segments-grid">
                    <!-- Generated by JS -->
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">SEGMENTATION FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üé®</div>
                            <div class="text-sm font-medium">Segment Builder</div>
                            <div class="text-xs text-gray-400 mt-1">Visual drag-drop</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üß†</div>
                            <div class="text-sm font-medium">Smart Segments</div>
                            <div class="text-xs text-gray-400 mt-1">Auto-update on behavior</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üìã</div>
                            <div class="text-sm font-medium">Templates</div>
                            <div class="text-xs text-gray-400 mt-1">VIP, At-Risk, New</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üîç</div>
                            <div class="text-sm font-medium">Overlap Analysis</div>
                            <div class="text-xs text-gray-400 mt-1">Multi-segment view</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üì§</div>
                            <div class="text-sm font-medium">Export Segment</div>
                            <div class="text-xs text-gray-400 mt-1">CSV/LDS.json</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- L3: DATA ARCHITECTURE -->
            <div id="content-data" class="layer-content hidden">
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-purple-400 mb-2">${Object.keys(data || {}).length || 8}</div>
                        <div class="text-sm text-gray-400">Data Objects</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-cyan-400 mb-2">24</div>
                        <div class="text-sm text-gray-400">Custom Fields</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-green-400 mb-2">100%</div>
                        <div class="text-sm text-gray-400">Data Validation</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">DATA ARCHITECTURE FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üèóÔ∏è</div>
                            <div class="text-sm font-medium">Schema Editor</div>
                            <div class="text-xs text-gray-400 mt-1">Custom objects/fields</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">‚úÖ</div>
                            <div class="text-sm font-medium">Data Validation</div>
                            <div class="text-xs text-gray-400 mt-1">Quality rules</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer" onclick="showModal('export-data')">
                            <div class="text-2xl mb-2">üì¶</div>
                            <div class="text-sm font-medium">Import/Export</div>
                            <div class="text-xs text-gray-400 mt-1">Bulk operations</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üó∫Ô∏è</div>
                            <div class="text-sm font-medium">Data Mapping</div>
                            <div class="text-xs text-gray-400 mt-1">External data</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 text-center hover:bg-white/10 transition cursor-pointer">
                            <div class="text-2xl mb-2">üíæ</div>
                            <div class="text-sm font-medium">Backup Manager</div>
                            <div class="text-xs text-gray-400 mt-1">Auto-backups</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- L4: CHANNELS -->
            <div id="content-channels" class="layer-content hidden">
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-blue-500">
                        <div class="text-3xl mb-2">üìß</div>
                        <div class="font-medium">Email</div>
                        <div class="text-xs text-green-400 mt-2">Connected</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-green-500">
                        <div class="text-3xl mb-2">üí¨</div>
                        <div class="font-medium">SMS</div>
                        <div class="text-xs text-yellow-400 mt-2">Configure</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-purple-500">
                        <div class="text-3xl mb-2">üåê</div>
                        <div class="font-medium">Social</div>
                        <div class="text-xs text-yellow-400 mt-2">Configure</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-cyan-500">
                        <div class="text-3xl mb-2">üîó</div>
                        <div class="font-medium">Webhooks</div>
                        <div class="text-xs text-green-400 mt-2">Active</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">CHANNEL FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚öôÔ∏è</div><div class="text-sm">Email Config</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üì±</div><div class="text-sm">SMS Config</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üîó</div><div class="text-sm">Social Links</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">ü™ù</div><div class="text-sm">Webhooks</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Channel Analytics</div></div>
                    </div>
                </div>
            </div>

            <!-- L5: CONTENT ENGINE -->
            <div id="content-content" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div class="text-sm text-gray-400">Template and content management</div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition">+ New Template</button>
                </div>
                <div class="glass rounded-xl p-8 mb-8 text-center">
                    <div class="text-6xl mb-4">üé®</div>
                    <h3 class="text-xl font-bold mb-2">Visual Email Builder</h3>
                    <p class="text-gray-400 mb-6">Drag-drop email designer with real-time preview</p>
                    <button class="bg-gradient-to-r from-purple-600 to-cyan-600 px-8 py-3 rounded-lg font-medium">Open Builder</button>
                </div>
                <div class="grid grid-cols-4 gap-4" id="template-library">
                    <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                        <div class="text-2xl mb-2">üìß</div>
                        <div class="font-medium">Welcome Email</div>
                        <div class="text-xs text-gray-400">Onboarding ‚Ä¢ Used 45x</div>
                    </div>
                    <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                        <div class="text-2xl mb-2">üì∞</div>
                        <div class="font-medium">Newsletter Header</div>
                        <div class="text-xs text-gray-400">Block ‚Ä¢ Used 156x</div>
                    </div>
                    <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                        <div class="text-2xl mb-2">üîò</div>
                        <div class="font-medium">CTA Button</div>
                        <div class="text-xs text-gray-400">Block ‚Ä¢ Used 234x</div>
                    </div>
                    <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                        <div class="text-2xl mb-2">üéâ</div>
                        <div class="font-medium">Product Announce</div>
                        <div class="text-xs text-gray-400">Promotion ‚Ä¢ Used 12x</div>
                    </div>
                </div>
            </div>

            <!-- L6: PERSONALIZATION -->
            <div id="content-personalization" class="layer-content hidden">
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">üè∑Ô∏è Merge Tags</h3>
                        <div class="space-y-2 text-sm">
                            <div class="glass-dark rounded p-2 mono">{{first_name}}</div>
                            <div class="glass-dark rounded p-2 mono">{{company}}</div>
                            <div class="glass-dark rounded p-2 mono">{{last_activity}}</div>
                        </div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">üéØ Conditional Content</h3>
                        <div class="text-sm text-gray-400">Show/hide content based on segment membership</div>
                        <div class="mt-4 text-xs text-green-400">3 active conditions</div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">ü§ñ AI Suggestions</h3>
                        <div class="text-sm text-gray-400">ML-powered content recommendations</div>
                        <div class="mt-4 text-xs text-purple-400">Powered by ValidKernel AI</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">PERSONALIZATION FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üè∑Ô∏è</div><div class="text-sm">Merge Tags</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üéØ</div><div class="text-sm">Conditional</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üñºÔ∏è</div><div class="text-sm">Dynamic Images</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">ü§ñ</div><div class="text-sm">AI Suggestions</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üîÄ</div><div class="text-sm">A/B Variants</div></div>
                    </div>
                </div>
            </div>

            <!-- L10: LEAD SCORING -->
            <div id="content-scoring" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div class="text-sm text-gray-400">Predictive lead scoring with behavior tracking</div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition" onclick="showModal('new-scoring-rule')">+ Add Rule</button>
                </div>
                <div class="grid grid-cols-3 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-green-400 mb-2">3</div>
                        <div class="text-sm text-gray-400">Hot Leads (80+)</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-yellow-400 mb-2">2</div>
                        <div class="text-sm text-gray-400">Warm Leads (50-79)</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-gray-400 mb-2">1</div>
                        <div class="text-sm text-gray-400">Cold Leads (<50)</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">SCORING RULES</h3>
                    <div class="space-y-3" id="scoring-rules">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- L11: A/B TESTING -->
            <div id="content-testing" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-bold">A/B Testing</h2>
                        <p class="text-gray-400 text-sm">Optimize through experimentation</p>
                    </div>
                    <button onclick="showModal('new-test')" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition">+ New Test</button>
                </div>
                <div class="grid grid-cols-3 gap-4 mb-8" id="tests-grid">
                    <div class="glass rounded-xl p-6 border-l-4 border-yellow-500 cursor-pointer hover:bg-white/10 transition" onclick="showModal('test-detail', 1)">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-400">RUNNING</span>
                            <span class="text-xs text-gray-400">2 variants</span>
                        </div>
                        <div class="font-medium mb-2">Subject Line Test</div>
                        <div class="text-xs text-gray-400">Started 2 days ago</div>
                    </div>
                    <div class="glass rounded-xl p-6 border-l-4 border-green-500 cursor-pointer hover:bg-white/10 transition" onclick="showModal('test-detail', 2)">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs px-2 py-1 rounded bg-green-500/20 text-green-400">COMPLETED</span>
                            <span class="text-xs text-gray-400">Winner: B</span>
                        </div>
                        <div class="font-medium mb-2">CTA Color Test</div>
                        <div class="text-xs text-green-400">+23% uplift</div>
                    </div>
                    <div class="glass rounded-xl p-6 border-l-4 border-green-500 cursor-pointer hover:bg-white/10 transition" onclick="showModal('test-detail', 3)">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs px-2 py-1 rounded bg-green-500/20 text-green-400">COMPLETED</span>
                            <span class="text-xs text-gray-400">Winner: C</span>
                        </div>
                        <div class="font-medium mb-2">Send Time Test</div>
                        <div class="text-xs text-green-400">+15% uplift</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">A/B TESTING FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìù</div><div class="text-sm">Subject Test</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìÑ</div><div class="text-sm">Content Test</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚è∞</div><div class="text-sm">Send Time</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Landing Page</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìà</div><div class="text-sm">Statistics</div></div>
                    </div>
                </div>
            </div>

            <!-- L13: COMPLIANCE -->
            <div id="content-compliance" class="layer-content hidden">
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üá™üá∫</div>
                        <div class="font-medium">GDPR</div>
                        <div class="text-xs text-green-400 mt-2">Compliant</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üá∫üá∏</div>
                        <div class="font-medium">CAN-SPAM</div>
                        <div class="text-xs text-green-400 mt-2">Compliant</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üîí</div>
                        <div class="font-medium">VTI‚Ñ¢</div>
                        <div class="text-xs text-green-400 mt-2">Enabled</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üìú</div>
                        <div class="font-medium">Audit Trail</div>
                        <div class="text-xs text-cyan-400 mt-2" onclick="showModal('audit-log')">View Log ‚Üí</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">COMPLIANCE FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üõ°Ô∏è</div><div class="text-sm">GDPR Tools</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚úÖ</div><div class="text-sm">CAN-SPAM Check</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üö´</div><div class="text-sm">Unsubscribe</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üóëÔ∏è</div><div class="text-sm">Data Retention</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer" onclick="showModal('audit-log')"><div class="text-2xl mb-2">üìú</div><div class="text-sm">Audit Trail</div></div>
                    </div>
                </div>
            </div>

            <!-- L14: INTEGRATIONS -->
            <div id="content-integrations" class="layer-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-xl font-bold">Integrations</h2>
                        <p class="text-gray-400 text-sm">Connect vkMRKTos to your favorite tools</p>
                    </div>
                    <button onclick="showModal('integration-setup')" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition">+ Add Integration</button>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-blue-500 cursor-pointer hover:bg-white/10 transition" onclick="toggleIntegration('salesforce')">
                        <div class="text-3xl mb-2">‚òÅÔ∏è</div>
                        <div class="font-medium">Salesforce</div>
                        <div class="text-xs text-yellow-400 mt-2">Click to Connect</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-orange-500 cursor-pointer hover:bg-white/10 transition" onclick="toggleIntegration('hubspot')">
                        <div class="text-3xl mb-2">üü†</div>
                        <div class="font-medium">HubSpot</div>
                        <div class="text-xs text-yellow-400 mt-2">Click to Connect</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-yellow-500 cursor-pointer hover:bg-white/10 transition" onclick="toggleIntegration('zapier')">
                        <div class="text-3xl mb-2">‚ö°</div>
                        <div class="font-medium">Zapier</div>
                        <div class="text-xs text-green-400 mt-2">5000+ apps</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center border-l-4 border-green-500 cursor-pointer hover:bg-white/10 transition" onclick="toggleIntegration('sheets')">
                        <div class="text-3xl mb-2">üìä</div>
                        <div class="font-medium">Google Sheets</div>
                        <div class="text-xs text-green-400 mt-2">‚úì Connected</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">QUICK ACTIONS</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer hover:bg-white/10 transition" onclick="showModal('integration-setup')"><div class="text-2xl mb-2">üîÑ</div><div class="text-sm">CRM Sync</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer hover:bg-white/10 transition" onclick="toggleIntegration('zapier')"><div class="text-2xl mb-2">‚ö°</div><div class="text-sm">Zapier</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer hover:bg-white/10 transition" onclick="showModal('integration-setup')"><div class="text-2xl mb-2">üîë</div><div class="text-sm">API Keys</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer hover:bg-white/10 transition" onclick="showModal('import-data')"><div class="text-2xl mb-2">üì•</div><div class="text-sm">Import</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer hover:bg-white/10 transition" onclick="showModal('export-data')"><div class="text-2xl mb-2">üì§</div><div class="text-sm">Export</div></div>
                    </div>
                </div>
            </div>

            <!-- L15: DELIVERABILITY -->
            <div id="content-deliverability" class="layer-content hidden">
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-green-400 mb-2">98.2%</div>
                        <div class="text-sm text-gray-400">Delivery Rate</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-cyan-400 mb-2">0.3%</div>
                        <div class="text-sm text-gray-400">Bounce Rate</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-green-400 mb-2">0.1%</div>
                        <div class="text-sm text-gray-400">Spam Complaints</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-purple-400 mb-2">A+</div>
                        <div class="text-sm text-gray-400">Sender Score</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">DELIVERABILITY FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üîç</div><div class="text-sm">Spam Check</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚Ü©Ô∏è</div><div class="text-sm">Bounce Mgr</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚ö´</div><div class="text-sm">Blacklist</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üîê</div><div class="text-sm">Auth (SPF/DKIM)</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üëÅÔ∏è</div><div class="text-sm">Inbox Preview</div></div>
                    </div>
                </div>
            </div>

            <!-- L16: AUDIENCE INTEL -->
            <div id="content-audience" class="layer-content hidden">
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">ü§ñ AI Insights</h3>
                        <div class="space-y-3">
                            <div class="glass-dark rounded-lg p-3 text-sm">Best send time: <span class="text-cyan-400 mono">Tuesday 10am</span></div>
                            <div class="glass-dark rounded-lg p-3 text-sm">Top content: <span class="text-purple-400">Product updates</span></div>
                            <div class="glass-dark rounded-lg p-3 text-sm">Churn risk: <span class="text-yellow-400 mono">2 contacts</span></div>
                        </div>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">üìà Engagement Trends</h3>
                        <div class="h-32 flex items-end justify-around gap-2">
                            <div class="bg-purple-500/50 rounded-t" style="height: 60%; width: 12%"></div>
                            <div class="bg-purple-500/50 rounded-t" style="height: 75%; width: 12%"></div>
                            <div class="bg-purple-500/50 rounded-t" style="height: 45%; width: 12%"></div>
                            <div class="bg-purple-500/50 rounded-t" style="height: 90%; width: 12%"></div>
                            <div class="bg-cyan-500/50 rounded-t" style="height: 85%; width: 12%"></div>
                            <div class="bg-cyan-500/50 rounded-t" style="height: 70%; width: 12%"></div>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">AUDIENCE INTEL FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìà</div><div class="text-sm">Trends</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚è∞</div><div class="text-sm">Best Time</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚ù§Ô∏è</div><div class="text-sm">Preferences</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚ö†Ô∏è</div><div class="text-sm">Churn Risk</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üë•</div><div class="text-sm">Lookalikes</div></div>
                    </div>
                </div>
            </div>

            <!-- L17: REVENUE INTEL -->
            <div id="content-revenue" class="layer-content hidden">
                <div id="revenue-stats">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- L19: JOURNEYS -->
            <div id="content-journeys" class="layer-content hidden">
                <div class="flex items-center justify-between mb-8">
                    <div class="text-sm text-gray-400">Customer journey orchestration</div>
                    <button class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition">+ New Journey</button>
                </div>
                <div class="glass rounded-xl p-8 mb-8 text-center">
                    <div class="text-6xl mb-4">üó∫Ô∏è</div>
                    <h3 class="text-xl font-bold mb-2">Visual Journey Builder</h3>
                    <p class="text-gray-400 mb-6">Drag-drop journey designer with triggers, waits, and branches</p>
                    <button class="bg-gradient-to-r from-purple-600 to-cyan-600 px-8 py-3 rounded-lg font-medium">Open Journey Builder</button>
                </div>
                <div class="grid grid-cols-2 gap-4" id="journeys-grid">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- L20: ABM -->
            <div id="content-abm" class="layer-content hidden">
                <div class="grid grid-cols-3 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-purple-400 mb-2">12</div>
                        <div class="text-sm text-gray-400">Target Accounts</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-cyan-400 mb-2">45</div>
                        <div class="text-sm text-gray-400">Stakeholders</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-4xl font-bold mono text-green-400 mb-2">$2.4M</div>
                        <div class="text-sm text-gray-400">Pipeline Value</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">ABM FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üè¢</div><div class="text-sm">Account Profiles</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Account Score</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üë•</div><div class="text-sm">Stakeholder Map</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üéØ</div><div class="text-sm">Account Plays</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìà</div><div class="text-sm">ABM Reports</div></div>
                    </div>
                </div>
            </div>

            <!-- L21: EXPERIMENTS -->
            <div id="content-experiments" class="layer-content hidden">
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl font-bold mono text-purple-400 mb-2">3</div>
                        <div class="text-sm text-gray-400">Active Experiments</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl font-bold mono text-cyan-400 mb-2">12</div>
                        <div class="text-sm text-gray-400">Completed</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl font-bold mono text-green-400 mb-2">+18%</div>
                        <div class="text-sm text-gray-400">Avg Uplift</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl font-bold mono text-yellow-400 mb-2">95%</div>
                        <div class="text-sm text-gray-400">Confidence</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">EXPERIMENT FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üéõÔ∏è</div><div class="text-sm">Holdout Groups</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Incrementality</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üî¢</div><div class="text-sm">Multi-variant</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìÖ</div><div class="text-sm">Calendar</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìà</div><div class="text-sm">Results</div></div>
                    </div>
                </div>
            </div>

            <!-- L22: REAL-TIME -->
            <div id="content-realtime" class="layer-content hidden">
                <div class="glass rounded-xl p-6 mb-8">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-3 h-3 bg-green-400 rounded-full pulse"></div>
                        <h3 class="text-lg font-bold mono">LIVE ACTIVITY STREAM</h3>
                    </div>
                    <div class="space-y-2 max-h-64 overflow-y-auto" id="realtime-feed">
                        <div class="glass-dark rounded p-3 flex items-center gap-3">
                            <span class="text-lg">üìß</span>
                            <div class="flex-1"><span class="text-sm">Sarah Chen</span> opened <span class="text-purple-400">Welcome Series</span></div>
                            <span class="text-xs text-gray-500 mono">2s ago</span>
                        </div>
                        <div class="glass-dark rounded p-3 flex items-center gap-3">
                            <span class="text-lg">üñ±Ô∏è</span>
                            <div class="flex-1"><span class="text-sm">Mike Wilson</span> clicked <span class="text-cyan-400">Product Launch</span></div>
                            <span class="text-xs text-gray-500 mono">5s ago</span>
                        </div>
                        <div class="glass-dark rounded p-3 flex items-center gap-3">
                            <span class="text-lg">üí∞</span>
                            <div class="flex-1"><span class="text-sm">Emily Davis</span> converted <span class="text-green-400">$75,000</span></div>
                            <span class="text-xs text-gray-500 mono">12s ago</span>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">REAL-TIME FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üì°</div><div class="text-sm">Live Feed</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚ö°</div><div class="text-sm">Triggers</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üéØ</div><div class="text-sm">Live Segments</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üîî</div><div class="text-sm">Alerts</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Live Dashboard</div></div>
                    </div>
                </div>
            </div>

            <!-- L23: PRIVACY -->
            <div id="content-privacy" class="layer-content hidden">
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">‚úÖ</div>
                        <div class="font-medium">Consent</div>
                        <div class="text-xs text-green-400 mt-2">98% opted-in</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üìã</div>
                        <div class="font-medium">DSAR</div>
                        <div class="text-xs text-green-400 mt-2">0 pending</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üîí</div>
                        <div class="font-medium">Encryption</div>
                        <div class="text-xs text-green-400 mt-2">AES-256</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-3xl mb-2">üç™</div>
                        <div class="font-medium">Cookie Consent</div>
                        <div class="text-xs text-green-400 mt-2">Active</div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">PRIVACY FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚úÖ</div><div class="text-sm">Consent Center</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìã</div><div class="text-sm">Data Requests</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üë§</div><div class="text-sm">Anonymization</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Privacy Reports</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üç™</div><div class="text-sm">Cookie Consent</div></div>
                    </div>
                </div>
            </div>

            <!-- L24: GOVERNANCE -->
            <div id="content-governance" class="layer-content hidden">
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">üë§ Current Role</h3>
                        <div class="text-2xl font-bold mb-2" id="current-role-display">Marketing Director</div>
                        <div class="text-sm text-gray-400">Trust Class: 0 (Full Access)</div>
                        <button class="mt-4 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm" onclick="showModal('governance')">Change Role</button>
                    </div>
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">üîê Access Control</h3>
                        <div class="text-sm text-gray-400 mb-2">Layers accessible: <span class="text-green-400 mono">24/24</span></div>
                        <div class="text-sm text-gray-400">Features enabled: <span class="text-green-400 mono">All</span></div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h3 class="text-lg font-bold mono mb-4">GOVERNANCE FEATURES</h3>
                    <div class="grid grid-cols-5 gap-4">
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer" onclick="showModal('governance')"><div class="text-2xl mb-2">üë•</div><div class="text-sm">User Mgmt</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center cursor-pointer" onclick="showModal('governance')"><div class="text-2xl mb-2">üé≠</div><div class="text-sm">Role Editor</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">‚öôÔ∏è</div><div class="text-sm">Settings</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üìä</div><div class="text-sm">Usage Analytics</div></div>
                        <div class="glass-dark rounded-lg p-4 text-center"><div class="text-2xl mb-2">üéöÔ∏è</div><div class="text-sm">Feature Toggles</div></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- MODAL OVERLAY -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-8">
        <div class="glass rounded-xl p-8 max-w-lg w-full" id="modal-content">
            <!-- Modal content injected by JS -->
        </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container" class="fixed bottom-8 right-8 z-50 space-y-2"></div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // vkMRKTos - Marketing Operating System by ValidKernel
        // VTI‚Ñ¢ Verified | 100% Auditable | User-Owned Data
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const MARKTOS_VERSION = '2.3.0';
        const STORAGE_KEY = 'marktos_data_v2';
        const AUDIT_KEY = 'marktos_audit_v1';
        const CONFIG_KEY = 'marktos_config_v1';

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // v2.0 GOVERNANCE - ROLE & FEATURE ACCESS CONTROL
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const JOB_ROLES = {
            super_admin: { label: 'SUPER_ADMIN', trustClass: -1, color: 'text-yellow-300', level: 'L0', description: 'L0 Authoritative Command Authority' },
            marketing_director: { label: 'Marketing Director', trustClass: 0, color: 'text-purple-400', level: 'L1', description: 'L1 Kernel Trusted Executor' },
            campaign_manager: { label: 'Campaign Manager', trustClass: 2, color: 'text-blue-400', level: 'L2', description: 'L2 Proposer' },
            content_marketer: { label: 'Content Marketer', trustClass: 3, color: 'text-cyan-400', level: 'L2', description: 'L2 Proposer' },
            sales_rep: { label: 'Sales Rep', trustClass: 2, color: 'text-green-400', level: 'L2', description: 'L2 Proposer' },
            data_analyst: { label: 'Data Analyst', trustClass: 4, color: 'text-yellow-400', level: 'L2', description: 'L2 Proposer' },
            compliance_officer: { label: 'Compliance Officer', trustClass: 1, color: 'text-red-400', level: 'L1', description: 'L1 Kernel Compliance' },
            viewer: { label: 'Viewer', trustClass: 5, color: 'text-gray-400', level: 'L2', description: 'L2 Read-Only' }
        };

        const LAYER_ACCESS = {
            dashboard: { minTrust: 5, roles: ['*'] },
            kernel: { minTrust: 1, roles: ['marketing_director', 'compliance_officer'] },
            identity: { minTrust: 2, roles: ['marketing_director', 'campaign_manager', 'sales_rep'] },
            segmentation: { minTrust: 2, roles: ['marketing_director', 'campaign_manager', 'data_analyst'] },
            data: { minTrust: 1, roles: ['marketing_director', 'data_analyst'] },
            channels: { minTrust: 2, roles: ['marketing_director', 'campaign_manager', 'content_marketer'] },
            content: { minTrust: 3, roles: ['marketing_director', 'campaign_manager', 'content_marketer'] },
            personalization: { minTrust: 3, roles: ['marketing_director', 'campaign_manager', 'content_marketer'] },
            campaigns: { minTrust: 2, roles: ['marketing_director', 'campaign_manager'] },
            automation: { minTrust: 2, roles: ['marketing_director', 'campaign_manager'] },
            leads: { minTrust: 2, roles: ['marketing_director', 'campaign_manager', 'sales_rep'] },
            scoring: { minTrust: 2, roles: ['marketing_director', 'campaign_manager', 'sales_rep'] },
            testing: { minTrust: 2, roles: ['marketing_director', 'campaign_manager'] },
            analytics: { minTrust: 4, roles: ['marketing_director', 'campaign_manager', 'data_analyst'] },
            compliance: { minTrust: 1, roles: ['marketing_director', 'compliance_officer'] },
            integrations: { minTrust: 1, roles: ['marketing_director', 'data_analyst'] },
            deliverability: { minTrust: 2, roles: ['marketing_director', 'campaign_manager'] },
            audience: { minTrust: 2, roles: ['marketing_director', 'campaign_manager', 'data_analyst'] },
            revenue: { minTrust: 1, roles: ['marketing_director', 'sales_rep'] },
            journeys: { minTrust: 2, roles: ['marketing_director', 'campaign_manager'] },
            abm: { minTrust: 2, roles: ['marketing_director', 'sales_rep'] },
            experiments: { minTrust: 1, roles: ['marketing_director', 'data_analyst'] },
            realtime: { minTrust: 3, roles: ['marketing_director', 'campaign_manager'] },
            privacy: { minTrust: 1, roles: ['marketing_director', 'compliance_officer'] },
            governance: { minTrust: 0, roles: ['marketing_director'] }
        };

        // Current user config
        let currentConfig = {
            jobRole: 'marketing_director',
            trustClass: 0,
            enabledLayers: Object.keys(LAYER_ACCESS),
            theme: 'dark'
        };

        function loadConfig() {
            try {
                const stored = localStorage.getItem(CONFIG_KEY);
                if (stored) {
                    Object.assign(currentConfig, JSON.parse(stored));
                }
            } catch (e) {
                console.warn('[MARKTOS] Config load failed:', e);
            }
            applyAccessControl();
        }

        function saveConfig() {
            try {
                localStorage.setItem(CONFIG_KEY, JSON.stringify(currentConfig));
                logAudit('CONFIG_CHANGE', { jobRole: currentConfig.jobRole, trustClass: currentConfig.trustClass }, 'IV.04');
            } catch (e) {
                console.warn('[MARKTOS] Config save failed:', e);
            }
        }

        function canAccessLayer(layerId) {
            const layer = LAYER_ACCESS[layerId];
            if (!layer) return true;

            // Trust class -1 = SUPER_ADMIN (L0), always has access to everything
            if (currentConfig.trustClass === -1) return true;

            // Trust class 0 = marketing director, always has access
            if (currentConfig.trustClass === 0) return true;

            // Check trust class (lower number = more access)
            if (currentConfig.trustClass > layer.minTrust) return false;

            // Check role
            if (layer.roles.includes('*')) return true;
            if (layer.roles.includes(currentConfig.jobRole)) return true;

            // Check if layer is explicitly enabled
            if (currentConfig.enabledLayers.includes(layerId)) return true;

            return false;
        }

        function applyAccessControl() {
            document.querySelectorAll('[data-layer]').forEach(el => {
                const layerId = el.dataset.layer;
                if (canAccessLayer(layerId)) {
                    el.classList.remove('hidden', 'opacity-50', 'pointer-events-none');
                } else {
                    el.classList.add('opacity-50', 'pointer-events-none');
                }
            });
            updateRoleDisplay();
        }

        function updateRoleDisplay() {
            const roleEl = document.getElementById('current-role-display');
            if (roleEl) {
                const role = JOB_ROLES[currentConfig.jobRole];
                roleEl.innerHTML = `<span class="${role.color}">${role.label}</span> <span class="text-gray-500">(TC${currentConfig.trustClass})</span>`;
            }
        }

        function setJobRole(roleId) {
            if (JOB_ROLES[roleId]) {
                currentConfig.jobRole = roleId;
                currentConfig.trustClass = JOB_ROLES[roleId].trustClass;
                saveConfig();
                applyAccessControl();
                showToast(`Role changed to ${JOB_ROLES[roleId].label}`, 'success');
            }
        }

        function toggleLayerAccess(layerId) {
            const idx = currentConfig.enabledLayers.indexOf(layerId);
            if (idx > -1) {
                currentConfig.enabledLayers.splice(idx, 1);
            } else {
                currentConfig.enabledLayers.push(layerId);
            }
            saveConfig();
            applyAccessControl();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // USER INTERFACE - View Modes, Navigation, Filtering
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let currentViewMode = 'cards';
        let currentSearchQuery = '';
        let currentFilters = { status: '', type: '' };
        let collapsedNavGroups = new Set();

        // Toggle navigation group collapse
        function toggleNavGroup(groupId) {
            const section = document.getElementById(`nav-${groupId}`);
            const chevron = document.getElementById(`${groupId}-chevron`);

            if (collapsedNavGroups.has(groupId)) {
                collapsedNavGroups.delete(groupId);
                section?.classList.remove('collapsed');
                if (chevron) chevron.textContent = '‚ñº';
            } else {
                collapsedNavGroups.add(groupId);
                section?.classList.add('collapsed');
                if (chevron) chevron.textContent = '‚ñ∂';
            }
        }

        // Set view mode (cards, list, table)
        function setViewMode(mode) {
            currentViewMode = mode;

            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });

            // Re-render current content with new view mode
            refreshCurrentView();
        }

        // Handle global search
        function handleSearch(query) {
            currentSearchQuery = query.toLowerCase();
            refreshCurrentView();
        }

        // Apply filters
        function applyFilters() {
            currentFilters.status = document.getElementById('filter-status')?.value || '';
            currentFilters.type = document.getElementById('filter-type')?.value || '';
            refreshCurrentView();
        }

        // Refresh current view based on active layer
        function refreshCurrentView() {
            const activeLayer = document.querySelector('.layer-content:not(.hidden)')?.id?.replace('content-', '');
            if (activeLayer) {
                renderLayerContent(activeLayer);
            }
        }

        // Generic render function for different view modes
        function renderItems(containerId, items, config) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Filter items
            let filtered = items.filter(item => {
                if (currentSearchQuery && !JSON.stringify(item).toLowerCase().includes(currentSearchQuery)) {
                    return false;
                }
                if (currentFilters.status && item.status !== currentFilters.status) {
                    return false;
                }
                if (currentFilters.type && item.type !== currentFilters.type) {
                    return false;
                }
                return true;
            });

            // Update results count
            const countEl = document.getElementById('results-count');
            if (countEl) countEl.textContent = `${filtered.length} items`;

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="text-4xl mb-4">üì≠</div>
                        <div class="text-lg mb-2">No items found</div>
                        <div class="text-sm">Try adjusting your filters or search</div>
                    </div>
                `;
                return;
            }

            switch (currentViewMode) {
                case 'cards':
                    container.innerHTML = `<div class="view-cards">${filtered.map(item => config.renderCard(item)).join('')}</div>`;
                    break;
                case 'list':
                    container.innerHTML = `<div class="view-list">${filtered.map(item => config.renderList(item)).join('')}</div>`;
                    break;
                case 'table':
                    container.innerHTML = `
                        <div class="glass rounded-lg overflow-hidden">
                            <div class="table-header" style="grid-template-columns: ${config.columns.map(c => c.width || '1fr').join(' ')}">
                                ${config.columns.map(col => `<div class="sortable" onclick="sortBy('${col.key}')">${col.label}</div>`).join('')}
                            </div>
                            <div>
                                ${filtered.map(item => config.renderRow(item, config.columns)).join('')}
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // Render layer-specific content
        function renderLayerContent(layerId) {
            switch(layerId) {
                case 'campaigns':
                    renderCampaignsView();
                    break;
                case 'identity':
                    renderContactsView();
                    break;
                case 'segmentation':
                    renderSegmentsView();
                    break;
                default:
                    // Keep existing render for other layers
                    break;
            }
        }

        // Campaigns View with multiple modes
        function renderCampaignsView() {
            const config = {
                columns: [
                    { key: 'name', label: 'Name', width: '2fr' },
                    { key: 'type', label: 'Type', width: '1fr' },
                    { key: 'status', label: 'Status', width: '100px' },
                    { key: 'sent', label: 'Sent', width: '80px' },
                    { key: 'opens', label: 'Opens', width: '80px' },
                    { key: 'clicks', label: 'Clicks', width: '80px' }
                ],
                renderCard: (c) => `
                    <div class="item-card" onclick="showModal('campaign-detail', ${c.id})">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-medium">${c.name}</span>
                            <span class="status-badge status-${c.status}">${c.status}</span>
                        </div>
                        <div class="text-xs text-gray-500 mb-3">${c.type}</div>
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div><div class="text-lg font-bold">${c.sent?.toLocaleString() || 0}</div><div class="text-xs text-gray-500">Sent</div></div>
                            <div><div class="text-lg font-bold">${c.opens?.toLocaleString() || 0}</div><div class="text-xs text-gray-500">Opens</div></div>
                            <div><div class="text-lg font-bold">${c.clicks?.toLocaleString() || 0}</div><div class="text-xs text-gray-500">Clicks</div></div>
                        </div>
                    </div>
                `,
                renderList: (c) => `
                    <div class="item-list" onclick="showModal('campaign-detail', ${c.id})">
                        <div class="flex-1">
                            <div class="font-medium">${c.name}</div>
                            <div class="text-xs text-gray-500">${c.type}</div>
                        </div>
                        <span class="status-badge status-${c.status}">${c.status}</span>
                        <div class="text-right text-sm">
                            <span class="text-gray-400">${c.sent?.toLocaleString() || 0} sent</span>
                        </div>
                    </div>
                `,
                renderRow: (c, cols) => `
                    <div class="table-row" style="grid-template-columns: ${cols.map(col => col.width || '1fr').join(' ')}" onclick="showModal('campaign-detail', ${c.id})">
                        <div class="font-medium">${c.name}</div>
                        <div class="text-gray-400">${c.type}</div>
                        <div><span class="status-badge status-${c.status}">${c.status}</span></div>
                        <div>${c.sent?.toLocaleString() || 0}</div>
                        <div>${c.opens?.toLocaleString() || 0}</div>
                        <div>${c.clicks?.toLocaleString() || 0}</div>
                    </div>
                `
            };

            document.getElementById('content-toolbar')?.classList.remove('hidden');
            renderItems('campaigns-container', data.campaigns, config);
        }

        // Contacts View with multiple modes
        function renderContactsView() {
            const config = {
                columns: [
                    { key: 'name', label: 'Name', width: '2fr' },
                    { key: 'email', label: 'Email', width: '2fr' },
                    { key: 'company', label: 'Company', width: '1.5fr' },
                    { key: 'score', label: 'Score', width: '80px' }
                ],
                renderCard: (l) => `
                    <div class="item-card" onclick="showModal('contact-detail', ${l.id})">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center font-bold">${l.name?.charAt(0) || '?'}</div>
                            <div>
                                <div class="font-medium">${l.name}</div>
                                <div class="text-xs text-gray-500">${l.company || 'No company'}</div>
                            </div>
                        </div>
                        <div class="text-xs text-gray-400">${l.email || 'No email'}</div>
                        <div class="flex gap-2 mt-3 flex-wrap">
                            ${(l.tags || []).slice(0, 3).map(t => `<span class="text-xs px-2 py-0.5 rounded bg-purple-500/20 text-purple-400">${t}</span>`).join('')}
                        </div>
                    </div>
                `,
                renderList: (l) => `
                    <div class="item-list" onclick="showModal('contact-detail', ${l.id})">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center text-sm font-bold">${l.name?.charAt(0) || '?'}</div>
                        <div class="flex-1">
                            <div class="font-medium">${l.name}</div>
                            <div class="text-xs text-gray-500">${l.email || 'No email'}</div>
                        </div>
                        <div class="text-sm text-gray-400">${l.company || '-'}</div>
                        <div class="text-sm font-medium text-purple-400">${l.score || 0}</div>
                    </div>
                `,
                renderRow: (l, cols) => `
                    <div class="table-row" style="grid-template-columns: ${cols.map(col => col.width || '1fr').join(' ')}" onclick="showModal('contact-detail', ${l.id})">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center text-xs font-bold">${l.name?.charAt(0) || '?'}</div>
                            <span class="font-medium">${l.name}</span>
                        </div>
                        <div class="text-gray-400">${l.email || '-'}</div>
                        <div class="text-gray-400">${l.company || '-'}</div>
                        <div class="text-purple-400 font-medium">${l.score || 0}</div>
                    </div>
                `
            };

            document.getElementById('content-toolbar')?.classList.remove('hidden');
            renderItems('contacts-container', data.leads, config);
        }

        // Segments View
        function renderSegmentsView() {
            const config = {
                columns: [
                    { key: 'name', label: 'Name', width: '2fr' },
                    { key: 'type', label: 'Type', width: '1fr' },
                    { key: 'count', label: 'Contacts', width: '100px' },
                    { key: 'conditions', label: 'Conditions', width: '2fr' }
                ],
                renderCard: (s) => `
                    <div class="item-card" onclick="showModal('segment-detail', ${s.id})">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium">${s.name}</span>
                            <span class="text-xs px-2 py-1 rounded ${s.type === 'dynamic' ? 'bg-cyan-500/20 text-cyan-400' : 'bg-gray-500/20 text-gray-400'}">${s.type}</span>
                        </div>
                        <div class="text-2xl font-bold mb-2">${s.count?.toLocaleString() || 0}</div>
                        <div class="text-xs text-gray-500">contacts</div>
                    </div>
                `,
                renderList: (s) => `
                    <div class="item-list" onclick="showModal('segment-detail', ${s.id})">
                        <div class="flex-1 font-medium">${s.name}</div>
                        <span class="text-xs px-2 py-1 rounded ${s.type === 'dynamic' ? 'bg-cyan-500/20 text-cyan-400' : 'bg-gray-500/20 text-gray-400'}">${s.type}</span>
                        <div class="text-sm">${s.count?.toLocaleString() || 0} contacts</div>
                    </div>
                `,
                renderRow: (s, cols) => `
                    <div class="table-row" style="grid-template-columns: ${cols.map(col => col.width || '1fr').join(' ')}" onclick="showModal('segment-detail', ${s.id})">
                        <div class="font-medium">${s.name}</div>
                        <div><span class="text-xs px-2 py-1 rounded ${s.type === 'dynamic' ? 'bg-cyan-500/20 text-cyan-400' : 'bg-gray-500/20 text-gray-400'}">${s.type}</span></div>
                        <div>${s.count?.toLocaleString() || 0}</div>
                        <div class="text-xs text-gray-400">${s.conditions?.map(c => `${c.field} ${c.op} ${c.value}`).join(', ') || 'Manual'}</div>
                    </div>
                `
            };

            document.getElementById('content-toolbar')?.classList.remove('hidden');
            renderItems('segments-container', data.segments, config);
        }

        // Show/hide admin section based on role
        function updateAdminVisibility() {
            const adminSection = document.getElementById('admin-section');
            if (adminSection) {
                adminSection.style.display = currentConfig.trustClass <= 0 ? 'block' : 'none';
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // VTI‚Ñ¢ - VERIFIABLE TRUST INFRASTRUCTURE
        // Trademark of ValidKernel.com
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const auditLog = [];
        const MAX_AUDIT_ENTRIES = 500;

        function logAudit(action, details, invariant = null) {
            const entry = {
                id: Date.now() + Math.random().toString(36).substr(2, 9),
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                invariant: invariant,
                role: 'super_admin',
                trust_level: 'L0_GOVERNANCE',
                verified: true
            };

            auditLog.unshift(entry);

            // Keep log size manageable
            if (auditLog.length > MAX_AUDIT_ENTRIES) {
                auditLog.pop();
            }

            // Persist audit log
            saveAuditLog();

            // Update trust score display
            updateTrustScore();

            console.log(`[VTI‚Ñ¢] ${action}:`, details);
            return entry;
        }

        function saveAuditLog() {
            try {
                localStorage.setItem(AUDIT_KEY, JSON.stringify(auditLog.slice(0, MAX_AUDIT_ENTRIES)));
            } catch (e) {
                console.warn('[VTI‚Ñ¢] Audit log save failed:', e.message);
            }
        }

        function loadAuditLog() {
            try {
                const stored = localStorage.getItem(AUDIT_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    auditLog.length = 0;
                    auditLog.push(...parsed);
                    console.log('[VTI‚Ñ¢] Audit log loaded:', auditLog.length, 'entries');
                }
            } catch (e) {
                console.warn('[VTI‚Ñ¢] Audit log load failed:', e.message);
            }
        }

        function calculateTrustScore() {
            // Trust Score based on:
            // 1. Invariant compliance (all 4 enforced = 40 points)
            // 2. Audit log health (recent activity = 20 points)
            // 3. Data integrity (valid structure = 20 points)
            // 4. Session stability (no errors = 20 points)

            let score = 0;

            // Invariant compliance (4 invariants x 10 points each)
            score += 40; // All invariants always enforced in ValidKernel

            // Audit log health (has recent entries)
            const recentEntries = auditLog.filter(e => {
                const age = Date.now() - new Date(e.timestamp).getTime();
                return age < 24 * 60 * 60 * 1000; // Last 24 hours
            });
            score += Math.min(20, recentEntries.length * 2);

            // Data integrity
            if (data && data.campaigns && data.leads && data.workflows) {
                score += 20;
            }

            // Session stability (base points for running system)
            score += 20;

            return Math.min(100, score);
        }

        function updateTrustScore() {
            const score = calculateTrustScore();
            const el = document.getElementById('sidebar-trust-score');
            if (el) {
                el.textContent = score;
                el.className = `ml-auto text-xs mono ${score >= 80 ? 'text-green-400' : score >= 60 ? 'text-yellow-400' : 'text-red-400'}`;
            }
        }

        function exportComplianceReport() {
            const report = {
                report_type: 'VTI_COMPLIANCE_REPORT',
                generated: new Date().toISOString(),
                generator: 'MARKTOS Genesis v' + MARKTOS_VERSION,
                kernel: {
                    name: 'ValidKernel',
                    version: '1.0.0',
                    vti_enabled: true,
                    vti_trademark: 'Verifiable Trust Infrastructure‚Ñ¢'
                },
                trust_score: calculateTrustScore(),
                invariants: {
                    'IV.01_TRUST_HIERARCHY': { status: 'ENFORCED', description: 'Authority flows L0‚ÜíL1‚ÜíL2 only' },
                    'IV.02_CHECK_THEN_ACT': { status: 'ENFORCED', description: 'All actions validated before execution' },
                    'IV.03_DETERMINISTIC_BOUNDARIES': { status: 'ENFORCED', description: 'Same input produces same output' },
                    'IV.04_ROLE_BASED_PERMISSIONS': { status: 'ENFORCED', description: '6-role RBAC matrix active' }
                },
                audit_summary: {
                    total_entries: auditLog.length,
                    last_24h: auditLog.filter(e => Date.now() - new Date(e.timestamp).getTime() < 86400000).length,
                    last_7d: auditLog.filter(e => Date.now() - new Date(e.timestamp).getTime() < 604800000).length
                },
                recent_audit_entries: auditLog.slice(0, 50),
                data_summary: {
                    campaigns: data.campaigns.length,
                    leads: data.leads.length,
                    workflows: data.workflows.length
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `marktos_compliance_report_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logAudit('COMPLIANCE_EXPORT', { entries: auditLog.length, score: calculateTrustScore() }, 'IV.01');
            showToast('Compliance report exported', 'success');
        }

        function undoAction(entryId) {
            const entry = auditLog.find(e => e.id === entryId);
            if (!entry) {
                showToast('Action not found', 'error');
                return;
            }

            // Log the undo attempt
            logAudit('UNDO_ATTEMPT', { original_action: entry.action, original_id: entryId }, 'IV.02');
            showToast('Undo logged - manual restoration required', 'info');
        }

        // INVARIANT IV.01: Trust Hierarchy
        const TRUST_LEVELS = {
            L0_GOVERNANCE: 0,
            L1_KERNEL: 1,
            L2_PROPOSER: 2
        };

        // INVARIANT IV.04: Role-Based Permissions
        const ROLES = {
            super_admin: { level: 0, permissions: ['*'], color: 'text-purple-400' },
            admin: { level: 1, permissions: ['campaign:*', 'contact:*', 'settings:read'], color: 'text-blue-400' },
            manager: { level: 2, permissions: ['campaign:create', 'campaign:send', 'contact:read'], color: 'text-cyan-400' },
            editor: { level: 3, permissions: ['campaign:create', 'template:edit'], color: 'text-green-400' },
            analyst: { level: 4, permissions: ['report:*', 'analytics:read'], color: 'text-yellow-400' },
            viewer: { level: 5, permissions: ['read:*'], color: 'text-gray-400' }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // VALIDKERNEL‚Ñ¢ COMMAND AUTHORIZATION SYSTEM
        // L0 Authoritative Commands | L2 Proposal Queue
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const COMMAND_LOG_KEY = 'marktos_commands_v1';
        const PROPOSAL_QUEUE_KEY = 'marktos_proposals_v1';

        // L0 Command Log - Stores all authoritative commands issued by SUPER_ADMIN
        let commandLog = [];

        // L2 Proposal Queue - Stores pending proposals awaiting L0 approval
        let proposalQueue = [];

        // Command Types
        const COMMAND_TYPES = {
            SYSTEM_CONFIG: { label: 'System Configuration', icon: '‚öôÔ∏è', level: 'L0' },
            USER_MANAGEMENT: { label: 'User Management', icon: 'üë•', level: 'L0' },
            DATA_OPERATION: { label: 'Data Operation', icon: 'üíæ', level: 'L0' },
            SECURITY_ACTION: { label: 'Security Action', icon: 'üîí', level: 'L0' },
            FEATURE_TOGGLE: { label: 'Feature Toggle', icon: 'üéöÔ∏è', level: 'L0' },
            APPROVAL: { label: 'Proposal Approval', icon: '‚úÖ', level: 'L0' },
            REJECTION: { label: 'Proposal Rejection', icon: '‚ùå', level: 'L0' }
        };

        // Proposal Status
        const PROPOSAL_STATUS = {
            PENDING: { label: 'Pending', color: 'text-yellow-400', bg: 'bg-yellow-500/20' },
            APPROVED: { label: 'Approved', color: 'text-green-400', bg: 'bg-green-500/20' },
            REJECTED: { label: 'Rejected', color: 'text-red-400', bg: 'bg-red-500/20' },
            IMPLEMENTED: { label: 'Implemented', color: 'text-cyan-400', bg: 'bg-cyan-500/20' }
        };

        function loadCommandLog() {
            try {
                const stored = localStorage.getItem(COMMAND_LOG_KEY);
                if (stored) {
                    commandLog = JSON.parse(stored);
                    console.log('[ValidKernel‚Ñ¢] Command log loaded:', commandLog.length, 'entries');
                }
            } catch (e) {
                console.warn('[ValidKernel‚Ñ¢] Command log load failed:', e.message);
            }
        }

        function saveCommandLog() {
            try {
                localStorage.setItem(COMMAND_LOG_KEY, JSON.stringify(commandLog.slice(0, 200)));
            } catch (e) {
                console.warn('[ValidKernel‚Ñ¢] Command log save failed:', e.message);
            }
        }

        function loadProposalQueue() {
            try {
                const stored = localStorage.getItem(PROPOSAL_QUEUE_KEY);
                if (stored) {
                    proposalQueue = JSON.parse(stored);
                    console.log('[ValidKernel‚Ñ¢] Proposal queue loaded:', proposalQueue.length, 'proposals');
                }
            } catch (e) {
                console.warn('[ValidKernel‚Ñ¢] Proposal queue load failed:', e.message);
            }
        }

        function saveProposalQueue() {
            try {
                localStorage.setItem(PROPOSAL_QUEUE_KEY, JSON.stringify(proposalQueue));
            } catch (e) {
                console.warn('[ValidKernel‚Ñ¢] Proposal queue save failed:', e.message);
            }
        }

        // Issue L0 Authoritative Command (SUPER_ADMIN only)
        function issueL0Command(type, description, details = {}) {
            if (currentConfig.trustClass !== -1) {
                showToast('L0 Commands require SUPER_ADMIN authority', 'error');
                logAudit('UNAUTHORIZED_L0_ATTEMPT', { type, role: currentConfig.jobRole }, 'IV.01');
                return null;
            }

            const command = {
                id: 'CMD_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                timestamp: new Date().toISOString(),
                type: type,
                typeInfo: COMMAND_TYPES[type] || { label: type, icon: '‚ö°', level: 'L0' },
                description: description,
                details: details,
                issuer: 'SUPER_ADMIN',
                trustLevel: 'L0_GOVERNANCE',
                status: 'EXECUTED',
                verified: true
            };

            commandLog.unshift(command);
            saveCommandLog();
            logAudit('L0_COMMAND_ISSUED', { commandId: command.id, type, description }, 'IV.01');
            updateCommandCenterUI();
            showToast(`L0 Command issued: ${description}`, 'success');
            console.log('[ValidKernel‚Ñ¢] L0 Command:', command);
            return command;
        }

        // Submit L2 Proposal (any non-L0 role)
        function submitL2Proposal(title, description, category, requestedAction) {
            if (currentConfig.trustClass === -1) {
                showToast('SUPER_ADMIN should issue commands directly, not proposals', 'info');
                return null;
            }

            const proposal = {
                id: 'PROP_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
                timestamp: new Date().toISOString(),
                title: title,
                description: description,
                category: category,
                requestedAction: requestedAction,
                proposer: {
                    role: currentConfig.jobRole,
                    roleLabel: JOB_ROLES[currentConfig.jobRole]?.label || currentConfig.jobRole,
                    trustClass: currentConfig.trustClass
                },
                status: 'PENDING',
                l0Response: null,
                responseTimestamp: null
            };

            proposalQueue.unshift(proposal);
            saveProposalQueue();
            logAudit('L2_PROPOSAL_SUBMITTED', { proposalId: proposal.id, title, category }, 'IV.01');
            updateCommandCenterUI();
            showToast(`Proposal submitted for L0 review: ${title}`, 'info');
            console.log('[ValidKernel‚Ñ¢] L2 Proposal:', proposal);
            return proposal;
        }

        // L0 Approve Proposal
        function approveProposal(proposalId, notes = '') {
            if (currentConfig.trustClass !== -1) {
                showToast('Only SUPER_ADMIN can approve proposals', 'error');
                return false;
            }

            const proposal = proposalQueue.find(p => p.id === proposalId);
            if (!proposal) {
                showToast('Proposal not found', 'error');
                return false;
            }

            proposal.status = 'APPROVED';
            proposal.l0Response = { action: 'APPROVED', notes: notes };
            proposal.responseTimestamp = new Date().toISOString();
            saveProposalQueue();

            // Issue corresponding L0 command
            issueL0Command('APPROVAL', `Approved: ${proposal.title}`, { proposalId, notes });
            updateCommandCenterUI();
            return true;
        }

        // L0 Reject Proposal
        function rejectProposal(proposalId, reason = '') {
            if (currentConfig.trustClass !== -1) {
                showToast('Only SUPER_ADMIN can reject proposals', 'error');
                return false;
            }

            const proposal = proposalQueue.find(p => p.id === proposalId);
            if (!proposal) {
                showToast('Proposal not found', 'error');
                return false;
            }

            proposal.status = 'REJECTED';
            proposal.l0Response = { action: 'REJECTED', reason: reason };
            proposal.responseTimestamp = new Date().toISOString();
            saveProposalQueue();

            // Issue corresponding L0 command
            issueL0Command('REJECTION', `Rejected: ${proposal.title}`, { proposalId, reason });
            updateCommandCenterUI();
            return true;
        }

        // Get pending proposals count
        function getPendingProposalsCount() {
            return proposalQueue.filter(p => p.status === 'PENDING').length;
        }

        // Update Command Center UI elements
        function updateCommandCenterUI() {
            const pendingCount = getPendingProposalsCount();
            const badge = document.getElementById('proposal-badge');
            if (badge) {
                badge.textContent = pendingCount;
                badge.style.display = pendingCount > 0 ? 'flex' : 'none';
            }

            // Update command counts in header and sidebar
            const commandCount = document.getElementById('command-count');
            if (commandCount) {
                commandCount.textContent = commandLog.length;
            }

            const sidebarCmdCount = document.getElementById('sidebar-cmd-count');
            if (sidebarCmdCount) {
                sidebarCmdCount.textContent = commandLog.length;
            }

            // Update sidebar trust level display based on current role
            const trustLevelEl = document.getElementById('trust-level-display');
            if (trustLevelEl) {
                if (currentConfig.trustClass === -1) {
                    trustLevelEl.innerHTML = 'Trust Level: <span class="text-yellow-300">L0_SUPER_ADMIN</span>';
                } else if (currentConfig.trustClass <= 1) {
                    trustLevelEl.innerHTML = 'Trust Level: <span class="text-purple-400">L1_KERNEL</span>';
                } else {
                    trustLevelEl.innerHTML = 'Trust Level: <span class="text-cyan-400">L2_PROPOSER</span>';
                }
            }

            // Update kernel status indicator based on role
            const kernelStatus = document.querySelector('.nav-item.border-yellow-500\\/30');
            if (kernelStatus && currentConfig.trustClass !== -1) {
                kernelStatus.classList.remove('text-yellow-300', 'border-yellow-500/30');
                kernelStatus.classList.add('text-gray-400', 'border-gray-500/30');
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PERSISTENCE LAYER (localStorage)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function saveData(silent = false) {
            try {
                const exportData = {
                    version: MARKTOS_VERSION,
                    exported: new Date().toISOString(),
                    kernel: 'ValidKernel v1.0.0',
                    vti_enabled: true,
                    data: data
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(exportData));
                if (!silent) {
                    logAudit('DATA_SAVE', { campaigns: data.campaigns.length, leads: data.leads.length }, 'IV.03');
                }
                console.log('[MARKTOS] Data saved to localStorage');
            } catch (e) {
                console.warn('[MARKTOS] localStorage save failed:', e.message);
            }
        }

        function loadData() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    if (parsed.data) {
                        Object.assign(data, parsed.data);
                        console.log('[MARKTOS] Data loaded from localStorage');
                        return true;
                    }
                }
            } catch (e) {
                console.warn('[MARKTOS] localStorage load failed:', e.message);
            }
            return false;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EXPORT/IMPORT LDS.json
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function exportLDS() {
            const exportData = {
                '$schema': 'marktos-lds-v1',
                version: MARKTOS_VERSION,
                exported: new Date().toISOString(),
                kernel: {
                    name: 'ValidKernel',
                    version: '1.0.0',
                    trust_level: 'L0_GOVERNANCE'
                },
                campaigns: data.campaigns,
                leads: data.leads,
                workflows: data.workflows,
                layers: data.layers
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `marktos_backup_${new Date().toISOString().split('T')[0]}.lds.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logAudit('LDS_EXPORT', { campaigns: data.campaigns.length, leads: data.leads.length, workflows: data.workflows.length }, 'IV.03');
            showToast('LDS.json exported successfully', 'success');
            closeModal();
        }

        function importLDS(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);

                    // Validate schema
                    if (!imported.campaigns && !imported.leads && !imported.data) {
                        throw new Error('Invalid LDS.json format');
                    }

                    // Handle both direct data and nested data formats
                    const importedData = imported.data || imported;

                    if (importedData.campaigns) data.campaigns = importedData.campaigns;
                    if (importedData.leads) data.leads = importedData.leads;
                    if (importedData.workflows) data.workflows = importedData.workflows;

                    saveData(true);
                    logAudit('LDS_IMPORT', { campaigns: data.campaigns.length, leads: data.leads.length }, 'IV.02');
                    refreshAllViews();
                    showToast(`Imported: ${data.campaigns.length} campaigns, ${data.leads.length} leads`, 'success');
                    closeModal();
                } catch (err) {
                    logAudit('LDS_IMPORT_FAILED', { error: err.message }, 'IV.02');
                    showToast('Import failed: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CHAT PARSER - Parse text into leads/contacts
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function parseChatText(text) {
            const leads = [];
            const lines = text.split('\n').filter(l => l.trim());

            // Pattern matching for common formats
            const emailRegex = /[\w.-]+@[\w.-]+\.\w+/gi;
            const phoneRegex = /[\+]?[(]?[0-9]{1,3}[)]?[-\s\.]?[(]?[0-9]{1,4}[)]?[-\s\.]?[0-9]{1,4}[-\s\.]?[0-9]{1,9}/g;
            const nameRegex = /^([A-Z][a-z]+\s+[A-Z][a-z]+)/;

            let currentLead = {};

            for (const line of lines) {
                const trimmed = line.trim();

                // Check for email
                const emails = trimmed.match(emailRegex);
                if (emails) {
                    if (currentLead.email) {
                        leads.push(currentLead);
                        currentLead = {};
                    }
                    currentLead.email = emails[0];
                }

                // Check for phone
                const phones = trimmed.match(phoneRegex);
                if (phones) {
                    currentLead.phone = phones[0];
                }

                // Check for name pattern
                const nameMatch = trimmed.match(nameRegex);
                if (nameMatch && !currentLead.name) {
                    currentLead.name = nameMatch[1];
                }

                // Check for company indicators
                if (trimmed.toLowerCase().includes('company:') || trimmed.toLowerCase().includes('org:')) {
                    currentLead.company = trimmed.split(':')[1]?.trim() || trimmed;
                }

                // Check for "Name - Company" format
                if (trimmed.includes(' - ') && !currentLead.name) {
                    const parts = trimmed.split(' - ');
                    currentLead.name = parts[0].trim();
                    currentLead.company = parts[1]?.trim();
                }

                // Check for "Name, Company" format
                if (trimmed.includes(', ') && !currentLead.name && !trimmed.includes('@')) {
                    const parts = trimmed.split(', ');
                    if (parts[0].split(' ').length <= 3) {
                        currentLead.name = parts[0].trim();
                        currentLead.company = parts[1]?.trim();
                    }
                }
            }

            // Don't forget last lead
            if (Object.keys(currentLead).length > 0) {
                leads.push(currentLead);
            }

            return leads;
        }

        function importFromChat() {
            const text = document.getElementById('chat-input').value;
            if (!text.trim()) {
                showToast('Please paste some text to parse', 'error');
                return;
            }

            const parsed = parseChatText(text);

            if (parsed.length === 0) {
                showToast('No leads found in text. Try formats like:\nJohn Doe - Acme Corp\njohn@acme.com', 'info');
                return;
            }

            // Convert to lead format and add to data
            parsed.forEach(p => {
                data.leads.push({
                    id: Date.now() + Math.random(),
                    name: p.name || 'Unknown',
                    company: p.company || 'Unknown',
                    email: p.email || '',
                    phone: p.phone || '',
                    value: 0,
                    stage: 'new',
                    score: 10
                });
            });

            saveData(true);
            logAudit('CHAT_IMPORT', { leads_added: parsed.length, names: parsed.map(p => p.name || p.email).slice(0, 5) }, 'IV.02');
            refreshAllViews();
            showToast(`Added ${parsed.length} leads from chat`, 'success');
            closeModal();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SHARE VIA LINK - Generate shareable data URL
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function generateShareLink() {
            const shareData = {
                v: MARKTOS_VERSION,
                c: data.campaigns.slice(0, 10),
                l: data.leads.slice(0, 50)
            };

            const compressed = btoa(encodeURIComponent(JSON.stringify(shareData)));
            const baseUrl = window.location.href.split('?')[0].split('#')[0];
            const shareUrl = `${baseUrl}?data=${compressed}`;

            document.getElementById('share-url').value = shareUrl;
            document.getElementById('share-url-container').classList.remove('hidden');

            // Check URL length
            if (shareUrl.length > 2000) {
                document.getElementById('share-warning').classList.remove('hidden');
            }
        }

        function copyShareLink() {
            const url = document.getElementById('share-url').value;
            navigator.clipboard.writeText(url).then(() => {
                showToast('Link copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                document.getElementById('share-url').select();
                document.execCommand('copy');
                showToast('Link copied!', 'success');
            });
        }

        function loadFromShareLink() {
            const params = new URLSearchParams(window.location.search);
            const sharedData = params.get('data');

            if (sharedData) {
                try {
                    const decoded = JSON.parse(decodeURIComponent(atob(sharedData)));
                    if (decoded.c) data.campaigns = decoded.c;
                    if (decoded.l) data.leads = decoded.l;
                    saveData();
                    showToast('Shared data loaded!', 'success');
                    // Clean URL
                    window.history.replaceState({}, '', window.location.pathname);
                } catch (e) {
                    console.warn('[MARKTOS] Failed to load shared data:', e);
                }
            }
        }

        function refreshAllViews() {
            renderGenomeGrid();
            renderCampaigns('campaign-list', 4);
            renderPipeline('pipeline-stages');
            renderWorkflows('workflow-grid', 4);
            renderActivityFeed();
        }

        // DATA STORE - v2.0 Extended
        const data = {
            campaigns: [
                { id: 1, name: 'Q1 Welcome Series', type: 'automation', status: 'active', sent: 45000, opens: 18000, clicks: 4500 },
                { id: 2, name: 'Product Launch Blast', type: 'broadcast', status: 'active', sent: 120000, opens: 38000, clicks: 9600 },
                { id: 3, name: 'Win-Back Campaign', type: 'automation', status: 'active', sent: 8000, opens: 2400, clicks: 480 },
                { id: 4, name: 'Newsletter Weekly', type: 'recurring', status: 'scheduled', sent: 0, opens: 0, clicks: 0 },
                { id: 5, name: 'Cart Abandonment', type: 'triggered', status: 'active', sent: 12000, opens: 5400, clicks: 1800 },
                { id: 6, name: 'Renewal Reminder', type: 'automation', status: 'draft', sent: 0, opens: 0, clicks: 0 }
            ],
            leads: [
                { id: 1, name: 'Sarah Chen', company: 'TechCorp', email: 'sarah@techcorp.com', phone: '+1-555-0101', value: 25000, stage: 'qualified', score: 85, tags: ['enterprise', 'hot'] },
                { id: 2, name: 'Mike Wilson', company: 'StartupXYZ', email: 'mike@startupxyz.com', phone: '+1-555-0102', value: 15000, stage: 'new', score: 45, tags: ['smb'] },
                { id: 3, name: 'Emily Davis', company: 'Enterprise Inc', email: 'emily@enterprise.com', phone: '+1-555-0103', value: 75000, stage: 'proposal', score: 92, tags: ['enterprise', 'hot'] },
                { id: 4, name: 'James Park', company: 'GrowthCo', email: 'james@growthco.com', phone: '+1-555-0104', value: 35000, stage: 'contacted', score: 68, tags: ['midmarket'] },
                { id: 5, name: 'Lisa Wang', company: 'Digital Agency', email: 'lisa@digitalagency.com', phone: '+1-555-0105', value: 18000, stage: 'qualified', score: 78, tags: ['agency'] },
                { id: 6, name: 'David Kim', company: 'SaaS Corp', email: 'david@saascorp.com', phone: '+1-555-0106', value: 120000, stage: 'negotiation', score: 95, tags: ['enterprise', 'hot'] }
            ],
            workflows: [
                { id: 1, name: 'Welcome Series', trigger: 'signup', steps: 5, active: true },
                { id: 2, name: 'Onboarding Flow', trigger: 'first_login', steps: 8, active: true },
                { id: 3, name: 'Re-engagement', trigger: 'inactive_30d', steps: 4, active: true },
                { id: 4, name: 'Birthday Campaign', trigger: 'birthday', steps: 2, active: true },
                { id: 5, name: 'Post-Purchase', trigger: 'purchase', steps: 6, active: false },
                { id: 6, name: 'Lead Nurture', trigger: 'form_submit', steps: 12, active: true }
            ],
            // v2.0 - Segments
            segments: [
                { id: 1, name: 'VIP Customers', type: 'dynamic', conditions: [{ field: 'score', op: 'gte', value: 80 }], count: 3, color: 'purple' },
                { id: 2, name: 'New Leads', type: 'dynamic', conditions: [{ field: 'stage', op: 'eq', value: 'new' }], count: 1, color: 'blue' },
                { id: 3, name: 'At Risk', type: 'dynamic', conditions: [{ field: 'score', op: 'lt', value: 50 }], count: 1, color: 'red' },
                { id: 4, name: 'Enterprise', type: 'dynamic', conditions: [{ field: 'value', op: 'gte', value: 50000 }], count: 2, color: 'green' },
                { id: 5, name: 'Newsletter Subscribers', type: 'static', conditions: [], count: 145, color: 'cyan' }
            ],
            // v2.0 - Scoring Rules
            scoringRules: [
                { id: 1, name: 'Email Open', action: 'email_open', points: 5, decay: 30, active: true },
                { id: 2, name: 'Email Click', action: 'email_click', points: 10, decay: 30, active: true },
                { id: 3, name: 'Page Visit', action: 'page_visit', points: 3, decay: 14, active: true },
                { id: 4, name: 'Pricing Page', action: 'pricing_view', points: 25, decay: 7, active: true },
                { id: 5, name: 'Demo Request', action: 'demo_request', points: 50, decay: 0, active: true },
                { id: 6, name: 'Form Submit', action: 'form_submit', points: 20, decay: 30, active: true }
            ],
            // v2.0 - Journeys
            journeys: [
                { id: 1, name: 'Customer Onboarding', status: 'active', steps: 8, enrolled: 234, completed: 189, conversionRate: 81 },
                { id: 2, name: 'Trial to Paid', status: 'active', steps: 5, enrolled: 567, completed: 198, conversionRate: 35 },
                { id: 3, name: 'Renewal Journey', status: 'active', steps: 4, enrolled: 145, completed: 132, conversionRate: 91 },
                { id: 4, name: 'Win-Back', status: 'paused', steps: 6, enrolled: 89, completed: 23, conversionRate: 26 }
            ],
            // v2.0 - Content Templates
            templates: [
                { id: 1, name: 'Welcome Email', type: 'email', category: 'onboarding', usedCount: 45 },
                { id: 2, name: 'Newsletter Header', type: 'block', category: 'newsletter', usedCount: 156 },
                { id: 3, name: 'CTA Button', type: 'block', category: 'conversion', usedCount: 234 },
                { id: 4, name: 'Product Announcement', type: 'email', category: 'promotion', usedCount: 12 }
            ],
            // v2.0 - A/B Tests
            tests: [
                { id: 1, name: 'Subject Line Test', type: 'subject', status: 'running', variants: 2, winner: null, uplift: 0 },
                { id: 2, name: 'CTA Color Test', type: 'content', status: 'completed', variants: 3, winner: 'B', uplift: 23 },
                { id: 3, name: 'Send Time Test', type: 'timing', status: 'completed', variants: 4, winner: 'C', uplift: 15 }
            ],
            // v2.0 - Revenue Tracking
            revenue: {
                mtd: 145000,
                lastMonth: 128000,
                ytd: 1450000,
                pipeline: 387000,
                deals: [
                    { id: 1, name: 'TechCorp Expansion', value: 75000, stage: 'negotiation', probability: 80 },
                    { id: 2, name: 'Enterprise Inc Renewal', value: 120000, stage: 'proposal', probability: 90 },
                    { id: 3, name: 'SaaS Corp Upsell', value: 45000, stage: 'qualified', probability: 60 }
                ]
            },
            layers: Array.from({length: 25}, (_, i) => ({
                id: i,
                name: `Layer ${i}`,
                health: Math.random() > 0.1 ? (Math.random() > 0.2 ? 'healthy' : 'warning') : 'critical'
            }))
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // RENDER FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function renderGenomeGrid() {
            const grid = document.getElementById('genome-grid');
            grid.innerHTML = data.layers.map((layer, i) => {
                const colors = { healthy: 'bg-green-500', warning: 'bg-yellow-500', critical: 'bg-red-500' };
                return `<div class="h-8 ${colors[layer.health]} rounded hover:scale-110 transition cursor-pointer" title="Layer ${i}: ${layer.health}"></div>`;
            }).join('');
        }

        function renderCampaigns(containerId, limit) {
            const container = document.getElementById(containerId);
            const campaigns = limit ? data.campaigns.slice(0, limit) : data.campaigns;

            container.innerHTML = campaigns.map(c => {
                const statusColors = { active: 'bg-green-500', scheduled: 'bg-blue-500', draft: 'bg-gray-500' };
                const openRate = c.sent > 0 ? ((c.opens / c.sent) * 100).toFixed(1) : 0;
                const clickRate = c.opens > 0 ? ((c.clicks / c.opens) * 100).toFixed(1) : 0;

                return `
                    <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs px-2 py-1 rounded ${statusColors[c.status]} text-white uppercase">${c.status}</span>
                            <span class="text-xs text-gray-400 mono">${c.type}</span>
                        </div>
                        <div class="font-medium mb-2">${c.name}</div>
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div><div class="text-xs text-gray-400">Sent</div><div class="mono text-sm">${(c.sent/1000).toFixed(1)}K</div></div>
                            <div><div class="text-xs text-gray-400">Open</div><div class="mono text-sm">${openRate}%</div></div>
                            <div><div class="text-xs text-gray-400">Click</div><div class="mono text-sm">${clickRate}%</div></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPipeline(containerId) {
            const container = document.getElementById(containerId);
            const stages = ['new', 'contacted', 'qualified', 'proposal', 'negotiation'];
            const stageNames = { new: 'New Leads', contacted: 'Contacted', qualified: 'Qualified', proposal: 'Proposal', negotiation: 'Negotiation' };

            container.innerHTML = stages.map(stage => {
                const stageLeads = data.leads.filter(l => l.stage === stage);
                const total = stageLeads.reduce((sum, l) => sum + l.value, 0);
                const pct = (stageLeads.length / data.leads.length) * 100;

                return `
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-gray-400">${stageNames[stage]}</span>
                            <span class="mono">${stageLeads.length} ($${(total/1000).toFixed(0)}K)</span>
                        </div>
                        <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-purple-500 to-cyan-400 rounded-full transition-all" style="width: ${pct}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderLeadPipeline() {
            const container = document.getElementById('lead-pipeline');
            const stages = ['new', 'contacted', 'qualified', 'negotiation'];
            const stageNames = { new: 'New', contacted: 'Contacted', qualified: 'Qualified', negotiation: 'Negotiation' };

            container.innerHTML = stages.map(stage => {
                const stageLeads = data.leads.filter(l => l.stage === stage);
                return `
                    <div class="glass rounded-xl p-4">
                        <div class="flex items-center justify-between mb-4 pb-4 border-b border-white/10">
                            <span class="mono text-sm uppercase">${stageNames[stage]}</span>
                            <span class="bg-purple-600 text-xs px-2 py-1 rounded mono">${stageLeads.length}</span>
                        </div>
                        <div class="space-y-3">
                            ${stageLeads.map(l => `
                                <div class="glass-dark rounded-lg p-3 cursor-pointer hover:bg-white/10 transition">
                                    <div class="font-medium text-sm">${l.name}</div>
                                    <div class="text-xs text-gray-400">${l.company}</div>
                                    <div class="flex justify-between mt-2">
                                        <span class="mono text-xs text-green-400">$${(l.value/1000).toFixed(0)}K</span>
                                        <span class="mono text-xs text-purple-400">Score: ${l.score}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderWorkflows(containerId, limit) {
            const container = document.getElementById(containerId);
            const workflows = limit ? data.workflows.slice(0, limit) : data.workflows;

            container.innerHTML = workflows.map(w => `
                <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-2 h-2 rounded-full ${w.active ? 'bg-green-400' : 'bg-gray-400'}"></div>
                        <span class="text-xs text-gray-400 mono">${w.steps} steps</span>
                    </div>
                    <div class="font-medium text-sm mb-1">${w.name}</div>
                    <div class="text-xs text-gray-400">Trigger: ${w.trigger}</div>
                </div>
            `).join('');
        }

        function renderWorkflowTemplates() {
            const templates = [
                { name: 'Welcome Series', desc: '5-email onboarding sequence', icon: 'üëã' },
                { name: 'Cart Abandonment', desc: 'Recover lost sales', icon: 'üõí' },
                { name: 'Lead Nurture', desc: '12-week drip campaign', icon: 'üå±' },
                { name: 'Re-engagement', desc: 'Win back inactive contacts', icon: 'üîÑ' },
                { name: 'Post-Purchase', desc: 'Cross-sell and upsell', icon: 'üéÅ' },
                { name: 'Event Reminder', desc: 'Webinar/event sequences', icon: 'üìÖ' }
            ];

            document.getElementById('workflow-templates').innerHTML = templates.map(t => `
                <div class="glass-dark rounded-lg p-6 hover:bg-white/10 transition cursor-pointer text-center">
                    <div class="text-4xl mb-3">${t.icon}</div>
                    <div class="font-medium mb-1">${t.name}</div>
                    <div class="text-xs text-gray-400">${t.desc}</div>
                </div>
            `).join('');
        }

        function renderRoleMatrix() {
            document.getElementById('role-matrix').innerHTML = Object.entries(ROLES).map(([name, role]) => `
                <tr class="border-b border-white/5">
                    <td class="py-3 ${role.color} mono uppercase">${name}</td>
                    <td class="py-3 mono">${role.level}</td>
                    <td class="py-3 text-xs text-gray-400">${role.permissions.join(', ')}</td>
                </tr>
            `).join('');
        }

        function renderActivityFeed() {
            const activities = [
                { type: 'email_open', contact: 'Sarah Chen', campaign: 'Welcome Series', time: '2s ago' },
                { type: 'form_submit', contact: 'New Lead', campaign: 'Landing Page', time: '15s ago' },
                { type: 'email_click', contact: 'Mike Wilson', campaign: 'Product Launch', time: '32s ago' },
                { type: 'conversion', contact: 'Emily Davis', campaign: 'Cart Recovery', time: '1m ago' },
                { type: 'email_open', contact: 'James Park', campaign: 'Newsletter', time: '2m ago' },
                { type: 'unsubscribe', contact: 'Anonymous', campaign: 'Promo Blast', time: '3m ago' },
                { type: 'email_open', contact: 'Lisa Wang', campaign: 'Onboarding', time: '4m ago' },
            ];

            const icons = {
                email_open: 'üìß',
                email_click: 'üñ±Ô∏è',
                form_submit: 'üìù',
                conversion: 'üí∞',
                unsubscribe: 'üö™'
            };

            const colors = {
                email_open: 'text-blue-400',
                email_click: 'text-cyan-400',
                form_submit: 'text-green-400',
                conversion: 'text-purple-400',
                unsubscribe: 'text-red-400'
            };

            document.getElementById('activity-feed').innerHTML = activities.map(a => `
                <div class="flex items-center gap-3 p-2 hover:bg-white/5 rounded transition">
                    <span class="text-lg">${icons[a.type]}</span>
                    <div class="flex-1">
                        <span class="text-sm">${a.contact}</span>
                        <span class="text-gray-500 mx-2">‚Ä¢</span>
                        <span class="text-xs text-gray-400">${a.campaign}</span>
                    </div>
                    <span class="text-xs text-gray-500 mono">${a.time}</span>
                </div>
            `).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // NAVIGATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Clean, user-friendly page configuration
        const layerConfig = {
            dashboard: { title: 'Dashboard', subtitle: 'Overview of your marketing performance' },
            kernel: { title: 'System Monitor', subtitle: 'ValidKernel trust infrastructure status', icon: 'üß¨' },
            identity: { title: 'All Contacts', subtitle: 'Manage your contact database', icon: 'üë§' },
            segmentation: { title: 'Segments', subtitle: 'Build and manage audience segments', icon: 'üéØ' },
            data: { title: 'Data Schema', subtitle: 'Configure data profiles and fields', icon: 'üíæ' },
            channels: { title: 'Channels', subtitle: 'Email, SMS, and social configuration', icon: 'üì°' },
            content: { title: 'Email Templates', subtitle: 'Design and manage email content', icon: 'üìù' },
            personalization: { title: 'Personalization', subtitle: 'Dynamic content and merge tags', icon: '‚ú®' },
            campaigns: { title: 'All Campaigns', subtitle: 'Create and manage marketing campaigns' },
            automation: { title: 'Workflows', subtitle: 'Build automated marketing sequences' },
            leads: { title: 'Lead Capture', subtitle: 'Forms, landing pages, and lead sources' },
            scoring: { title: 'Lead Scoring', subtitle: 'Define scoring rules and thresholds', icon: 'üìà' },
            testing: { title: 'A/B Testing', subtitle: 'Optimize with split tests', icon: 'üß™' },
            analytics: { title: 'Reports', subtitle: 'Analyze performance and trends' },
            compliance: { title: 'Compliance Center', subtitle: 'GDPR, CAN-SPAM, and consent management', icon: 'üîí' },
            integrations: { title: 'Connectors', subtitle: 'Connect to external platforms', icon: 'üîó' },
            deliverability: { title: 'Deliverability', subtitle: 'Email health and reputation', icon: 'üì¨' },
            audience: { title: 'Audience Insights', subtitle: 'Understand your audience behavior', icon: 'üß†' },
            revenue: { title: 'Revenue', subtitle: 'Track pipeline and revenue attribution', icon: 'üí∞' },
            journeys: { title: 'Customer Journeys', subtitle: 'Design multi-touch experiences', icon: 'üó∫Ô∏è' },
            abm: { title: 'Account-Based Marketing', subtitle: 'Target accounts and stakeholders', icon: 'üè¢' },
            experiments: { title: 'Experiments', subtitle: 'Run controlled experiments', icon: 'üî¨' },
            realtime: { title: 'Real-Time Triggers', subtitle: 'Event-driven automation', icon: '‚ö°' },
            privacy: { title: 'Privacy', subtitle: 'Consent and data rights management', icon: 'üõ°Ô∏è' },
            governance: { title: 'Governance', subtitle: 'Users, roles, and permissions', icon: '‚öôÔ∏è' }
        };

        function showLayer(layerId) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            event?.target?.closest('.nav-item')?.classList.add('active');

            // Hide all content
            document.querySelectorAll('.layer-content').forEach(c => c.classList.add('hidden'));

            // Get config
            const config = layerConfig[layerId] || { title: layerId.toUpperCase(), subtitle: 'Layer Module' };

            // Update header
            document.getElementById('page-title').textContent = config.title;
            document.getElementById('page-subtitle').textContent = config.subtitle;

            // Show appropriate content
            const contentEl = document.getElementById('content-' + layerId);
            if (contentEl) {
                contentEl.classList.remove('hidden');

                // Render specific content for each layer
                if (layerId === 'campaigns') renderCampaigns('all-campaigns');
                if (layerId === 'leads') renderLeadPipeline();
                if (layerId === 'automation') renderWorkflowTemplates();
                if (layerId === 'kernel') renderRoleMatrix();
                if (layerId === 'identity') renderIdentity();
                if (layerId === 'segmentation') renderSegments();
                if (layerId === 'scoring') renderScoringRules();
                if (layerId === 'journeys') renderJourneys();
                if (layerId === 'revenue') renderRevenue();
            } else {
                // Show generic layer placeholder
                const generic = document.getElementById('content-generic');
                generic.classList.remove('hidden');
                document.getElementById('generic-icon').textContent = config.icon || 'üß¨';
                document.getElementById('generic-title').textContent = config.title;
                document.getElementById('generic-desc').textContent = `${config.subtitle} - Part of the 25-layer marketing genome.`;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MODALS & TOAST
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function showModal(type) {
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');

            if (type === 'new-campaign') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-6">CREATE CAMPAIGN</h2>
                    <form onsubmit="createCampaign(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Campaign Name</label>
                                <input type="text" id="campaign-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Type</label>
                                <select id="campaign-type" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500">
                                    <option value="broadcast">Broadcast</option>
                                    <option value="automation">Automation</option>
                                    <option value="triggered">Triggered</option>
                                    <option value="recurring">Recurring</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-8">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button type="submit" class="flex-1 py-3 bg-purple-600 rounded-lg hover:bg-purple-700 transition font-medium">Create</button>
                        </div>
                    </form>
                `;
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // v1.1 DATA TOOLS MODALS
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            if (type === 'export-data') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üì§ EXPORT LDS.JSON</h2>
                    <p class="text-gray-400 text-sm mb-6">Download your complete vkMRKTos data backup</p>
                    <div class="glass-dark rounded-lg p-4 mb-6">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="text-gray-400">Campaigns:</span> <span class="mono text-cyan-400">${data.campaigns.length}</span></div>
                            <div><span class="text-gray-400">Leads:</span> <span class="mono text-cyan-400">${data.leads.length}</span></div>
                            <div><span class="text-gray-400">Workflows:</span> <span class="mono text-cyan-400">${data.workflows.length}</span></div>
                            <div><span class="text-gray-400">Format:</span> <span class="mono text-green-400">LDS.json</span></div>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                        <button onclick="exportLDS()" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Download Backup</button>
                    </div>
                `;
            }

            if (type === 'import-data') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üì• IMPORT LDS.JSON</h2>
                    <p class="text-gray-400 text-sm mb-6">Restore data from a backup file</p>
                    <div class="glass-dark rounded-lg p-8 mb-6 text-center border-2 border-dashed border-white/20 hover:border-purple-500 transition cursor-pointer" onclick="document.getElementById('file-input').click()">
                        <div class="text-4xl mb-3">üìÅ</div>
                        <div class="text-sm">Click to select LDS.json file</div>
                        <div class="text-xs text-gray-500 mt-1">or drag and drop</div>
                        <input type="file" id="file-input" accept=".json,.lds.json" class="hidden" onchange="importLDS(this.files[0])">
                    </div>
                    <div class="text-xs text-yellow-500 mb-4">‚ö†Ô∏è This will replace your current data</div>
                    <button onclick="closeModal()" class="w-full py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                `;
            }

            if (type === 'chat-parser') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üí¨ CHAT PARSER</h2>
                    <p class="text-gray-400 text-sm mb-4">Paste text to auto-extract leads and contacts</p>
                    <div class="mb-4">
                        <textarea id="chat-input" class="w-full h-48 bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500 text-sm" placeholder="Paste contact info here...

Supported formats:
‚Ä¢ John Doe - Acme Corp
‚Ä¢ jane@company.com
‚Ä¢ Name, Company Name
‚Ä¢ Company: TechCorp
‚Ä¢ +1 (555) 123-4567"></textarea>
                    </div>
                    <div class="glass-dark rounded-lg p-3 mb-4 text-xs text-gray-400">
                        <strong class="text-cyan-400">Tip:</strong> The parser detects emails, phone numbers, names, and company names from common formats.
                    </div>
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                        <button onclick="importFromChat()" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Parse & Import</button>
                    </div>
                `;
            }

            if (type === 'share-link') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üîó SHARE VIA LINK</h2>
                    <p class="text-gray-400 text-sm mb-6">Generate a shareable URL containing your data</p>
                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm mb-2"><span class="text-gray-400">Includes:</span></div>
                        <div class="text-xs text-gray-500">‚Ä¢ Up to 10 campaigns</div>
                        <div class="text-xs text-gray-500">‚Ä¢ Up to 50 leads</div>
                        <div class="text-xs text-gray-500">‚Ä¢ Encoded in URL (no server needed)</div>
                    </div>
                    <div id="share-url-container" class="hidden mb-4">
                        <label class="block text-xs text-gray-400 uppercase mb-2">Share URL</label>
                        <div class="flex gap-2">
                            <input type="text" id="share-url" readonly class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-xs mono focus:outline-none">
                            <button onclick="copyShareLink()" class="px-4 py-2 bg-cyan-600 rounded-lg hover:bg-cyan-700 transition text-sm">Copy</button>
                        </div>
                    </div>
                    <div id="share-warning" class="hidden text-xs text-yellow-500 mb-4">‚ö†Ô∏è URL is long and may not work in all browsers/apps</div>
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                        <button onclick="generateShareLink()" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Generate Link</button>
                    </div>
                `;
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // v1.2 VTI‚Ñ¢ MODALS - Verifiable Trust Infrastructure
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            if (type === 'trust-score') {
                const score = calculateTrustScore();
                const scoreColor = score >= 80 ? 'text-green-400' : score >= 60 ? 'text-yellow-400' : 'text-red-400';
                const scoreBar = score >= 80 ? 'from-green-600 to-green-400' : score >= 60 ? 'from-yellow-600 to-yellow-400' : 'from-red-600 to-red-400';

                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üõ°Ô∏è VTI‚Ñ¢ TRUST SCORE</h2>
                    <p class="text-gray-400 text-sm mb-6">Verifiable Trust Infrastructure‚Ñ¢ by ValidKernel.com</p>

                    <div class="text-center mb-6">
                        <div class="text-6xl font-bold mono ${scoreColor}">${score}</div>
                        <div class="text-gray-400 text-sm mt-2">Trust Score (0-100)</div>
                        <div class="w-full bg-white/10 rounded-full h-3 mt-4">
                            <div class="h-3 rounded-full bg-gradient-to-r ${scoreBar}" style="width: ${score}%"></div>
                        </div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-purple-400">KERNEL INVARIANTS</div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs">
                                <span>IV.01: Trust Hierarchy</span>
                                <span class="text-green-400">‚úì ENFORCED</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span>IV.02: Check-Then-Act</span>
                                <span class="text-green-400">‚úì ENFORCED</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span>IV.03: Deterministic Boundaries</span>
                                <span class="text-green-400">‚úì ENFORCED</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span>IV.04: Role-Based Permissions</span>
                                <span class="text-green-400">‚úì ENFORCED</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-cyan-400">AUDIT SUMMARY</div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div>Total entries: <span class="mono text-white">${auditLog.length}</span></div>
                            <div>Last 24h: <span class="mono text-white">${auditLog.filter(e => Date.now() - new Date(e.timestamp).getTime() < 86400000).length}</span></div>
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Close</button>
                `;
            }

            if (type === 'audit-log') {
                const recentLogs = auditLog.slice(0, 20);

                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üìú VTI‚Ñ¢ AUDIT LOG</h2>
                    <p class="text-gray-400 text-sm mb-4">Complete action history with invariant verification</p>

                    <div class="max-h-96 overflow-y-auto mb-4">
                        ${recentLogs.length === 0 ? '<div class="text-center text-gray-500 py-8">No audit entries yet</div>' : recentLogs.map(entry => `
                            <div class="glass-dark rounded-lg p-3 mb-2">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="text-sm font-medium text-purple-400">${entry.action}</span>
                                    <span class="text-xs text-gray-500 mono">${new Date(entry.timestamp).toLocaleString()}</span>
                                </div>
                                <div class="text-xs text-gray-400 mb-1">${JSON.stringify(entry.details).slice(0, 80)}...</div>
                                <div class="flex gap-2 text-xs">
                                    ${entry.invariant ? `<span class="text-green-400">‚úì ${entry.invariant}</span>` : ''}
                                    <span class="text-cyan-400">${entry.trust_level}</span>
                                    <span class="${entry.verified ? 'text-green-400' : 'text-red-400'}">${entry.verified ? 'VERIFIED' : 'UNVERIFIED'}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Close</button>
                        <button onclick="exportComplianceReport(); closeModal();" class="flex-1 py-3 bg-gradient-to-r from-green-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Export Report</button>
                    </div>
                `;
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // v2.0 GOVERNANCE MODAL - Role & Access Control
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            if (type === 'governance') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">‚öôÔ∏è GOVERNANCE</h2>
                    <p class="text-gray-400 text-sm mb-6">Role-based access control and feature toggles</p>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-purple-400">CURRENT ROLE</div>
                        <select id="role-selector" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500" onchange="setJobRole(this.value)">
                            ${Object.entries(JOB_ROLES).map(([id, role]) => `
                                <option value="${id}" ${currentConfig.jobRole === id ? 'selected' : ''}>${role.label} (Trust Class ${role.trustClass})</option>
                            `).join('')}
                        </select>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-cyan-400">TRUST CLASS</div>
                        <div class="text-4xl font-bold mono text-center text-cyan-400">${currentConfig.trustClass}</div>
                        <div class="text-xs text-gray-400 text-center mt-2">Lower = More Access (0-5)</div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4 max-h-48 overflow-y-auto">
                        <div class="text-sm font-bold mb-3 text-green-400">LAYER ACCESS</div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            ${Object.entries(LAYER_ACCESS).map(([id, config]) => `
                                <div class="flex items-center gap-2">
                                    <span class="${canAccessLayer(id) ? 'text-green-400' : 'text-red-400'}">${canAccessLayer(id) ? '‚úì' : '‚úó'}</span>
                                    <span class="${canAccessLayer(id) ? 'text-white' : 'text-gray-500'}">${id}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Close</button>
                `;
            }

            // v2.0 - New Segment Modal
            if (type === 'new-segment') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-6">üéØ CREATE SEGMENT</h2>
                    <form onsubmit="createSegment(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Segment Name</label>
                                <input type="text" id="segment-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500" placeholder="e.g., High-Value Leads" required>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Type</label>
                                <select id="segment-type" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500">
                                    <option value="dynamic">Dynamic (auto-update)</option>
                                    <option value="static">Static (manual)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Condition</label>
                                <div class="flex gap-2">
                                    <select id="segment-field" class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="score">Lead Score</option>
                                        <option value="value">Deal Value</option>
                                        <option value="stage">Pipeline Stage</option>
                                    </select>
                                    <select id="segment-op" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="gte">‚â•</option>
                                        <option value="lte">‚â§</option>
                                        <option value="eq">=</option>
                                    </select>
                                    <input type="text" id="segment-value" class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm" placeholder="Value">
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-8">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button type="submit" class="flex-1 py-3 bg-purple-600 rounded-lg hover:bg-purple-700 transition font-medium">Create Segment</button>
                        </div>
                    </form>
                `;
            }

            // v2.0 - New Scoring Rule Modal
            if (type === 'new-scoring-rule') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-6">üìà ADD SCORING RULE</h2>
                    <form onsubmit="createScoringRule(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Rule Name</label>
                                <input type="text" id="rule-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500" placeholder="e.g., Pricing Page Visit" required>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 uppercase mb-2">Trigger Action</label>
                                <select id="rule-action" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500">
                                    <option value="email_open">Email Open</option>
                                    <option value="email_click">Email Click</option>
                                    <option value="page_visit">Page Visit</option>
                                    <option value="form_submit">Form Submit</option>
                                    <option value="demo_request">Demo Request</option>
                                    <option value="pricing_view">Pricing Page View</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-400 uppercase mb-2">Points</label>
                                    <input type="number" id="rule-points" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500" value="10" min="1" max="100">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 uppercase mb-2">Decay (days)</label>
                                    <input type="number" id="rule-decay" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500" value="30" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-8">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button type="submit" class="flex-1 py-3 bg-purple-600 rounded-lg hover:bg-purple-700 transition font-medium">Add Rule</button>
                        </div>
                    </form>
                `;
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // VALIDKERNEL‚Ñ¢ COMMAND AUTHORIZATION MODALS
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            // L0 Command Center Modal
            if (type === 'command-center') {
                const recentCommands = commandLog.slice(0, 15);
                const isL0 = currentConfig.trustClass === -1;

                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">‚ö° L0 COMMAND CENTER</h2>
                    <p class="text-gray-400 text-sm mb-4">ValidKernel‚Ñ¢ Authoritative Command Log</p>

                    ${isL0 ? `
                    <!-- Issue New Command (L0 Only) -->
                    <div class="glass-dark rounded-lg p-4 mb-4 border border-yellow-500/30">
                        <div class="text-sm font-bold mb-3 text-yellow-400">ISSUE L0 COMMAND</div>
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <select id="cmd-type" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                <option value="SYSTEM_CONFIG">‚öôÔ∏è System Config</option>
                                <option value="USER_MANAGEMENT">üë• User Management</option>
                                <option value="DATA_OPERATION">üíæ Data Operation</option>
                                <option value="SECURITY_ACTION">üîí Security Action</option>
                                <option value="FEATURE_TOGGLE">üéöÔ∏è Feature Toggle</option>
                            </select>
                            <input type="text" id="cmd-description" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm" placeholder="Command description...">
                        </div>
                        <button onclick="executeCommandFromModal()" class="w-full py-2 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg text-sm font-medium hover:opacity-90 transition">
                            ‚ö° Execute L0 Command
                        </button>
                    </div>
                    ` : `
                    <div class="glass-dark rounded-lg p-4 mb-4 border border-gray-500/30">
                        <div class="text-center text-gray-400">
                            <span class="text-2xl">üîí</span>
                            <div class="text-sm mt-2">L0 Commands require SUPER_ADMIN authority</div>
                            <div class="text-xs mt-1">Current: ${JOB_ROLES[currentConfig.jobRole]?.label || currentConfig.jobRole}</div>
                        </div>
                    </div>
                    `}

                    <!-- DATA ECOSYSTEM MAP -->
                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-cyan-400">üìç DATA ECOSYSTEM MAP</div>
                        <div class="text-xs text-gray-400 mb-4">ValidKernel OS Product Data Zones ‚Äî Equal & Interoperable</div>

                        <!-- Visual Map - Pentagon Layout -->
                        <div class="relative h-48 mb-4">
                            <!-- Center Hub -->
                            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 rounded-full bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center z-10 shadow-lg" style="box-shadow: 0 0 20px rgba(234,179,8,0.4);">
                                <span class="text-xs font-bold">VK</span>
                            </div>

                            <!-- Connection Lines (SVG) -->
                            <svg class="absolute inset-0 w-full h-full" style="z-index: 1;">
                                <line x1="50%" y1="8%" x2="50%" y2="42%" stroke="rgba(168,85,247,0.4)" stroke-width="2"/>
                                <line x1="88%" y1="32%" x2="58%" y2="46%" stroke="rgba(6,182,212,0.4)" stroke-width="2"/>
                                <line x1="76%" y1="88%" x2="54%" y2="54%" stroke="rgba(34,197,94,0.4)" stroke-width="2"/>
                                <line x1="24%" y1="88%" x2="46%" y2="54%" stroke="rgba(251,146,60,0.4)" stroke-width="2"/>
                                <line x1="12%" y1="32%" x2="42%" y2="46%" stroke="rgba(236,72,153,0.4)" stroke-width="2"/>
                            </svg>

                            <!-- 5 Equal Data Zones in Pentagon -->
                            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 text-center" style="z-index: 2;">
                                <div class="w-12 h-12 rounded-full bg-purple-500/30 border-2 border-purple-400 flex items-center justify-center mx-auto mb-1">üìä</div>
                                <div class="text-xs font-bold text-purple-400">MRKT</div>
                            </div>
                            <div class="absolute top-1/4 right-2 text-center" style="z-index: 2;">
                                <div class="w-12 h-12 rounded-full bg-cyan-500/30 border-2 border-cyan-400 flex items-center justify-center mx-auto mb-1">üíπ</div>
                                <div class="text-xs font-bold text-cyan-400">TRADE</div>
                            </div>
                            <div class="absolute bottom-2 right-1/4 text-center" style="z-index: 2;">
                                <div class="w-12 h-12 rounded-full bg-green-500/30 border-2 border-green-400 flex items-center justify-center mx-auto mb-1">üí∞</div>
                                <div class="text-xs font-bold text-green-400">VCE</div>
                            </div>
                            <div class="absolute bottom-2 left-1/4 text-center" style="z-index: 2;">
                                <div class="w-12 h-12 rounded-full bg-orange-500/30 border-2 border-orange-400 flex items-center justify-center mx-auto mb-1">üéôÔ∏è</div>
                                <div class="text-xs font-bold text-orange-400">VOICE</div>
                            </div>
                            <div class="absolute top-1/4 left-2 text-center" style="z-index: 2;">
                                <div class="w-12 h-12 rounded-full bg-pink-500/30 border-2 border-pink-400 flex items-center justify-center mx-auto mb-1">üìã</div>
                                <div class="text-xs font-bold text-pink-400">SPEC</div>
                            </div>
                        </div>

                        <!-- Data Zone List -->
                        <div class="grid grid-cols-5 gap-1 text-center text-xs">
                            <div class="glass rounded p-1">
                                <div class="text-purple-400 font-bold">vkMRKTos</div>
                                <div class="text-gray-500 text-xxs">Marketing</div>
                            </div>
                            <div class="glass rounded p-1">
                                <div class="text-cyan-400 font-bold">vkTRADEos</div>
                                <div class="text-gray-500 text-xxs">Trading</div>
                            </div>
                            <div class="glass rounded p-1">
                                <div class="text-green-400 font-bold">vkVCEos</div>
                                <div class="text-gray-500 text-xxs">Venture</div>
                            </div>
                            <div class="glass rounded p-1">
                                <div class="text-orange-400 font-bold">vkVOICEos</div>
                                <div class="text-gray-500 text-xxs">Voice</div>
                            </div>
                            <div class="glass rounded p-1">
                                <div class="text-pink-400 font-bold">vkSPECos</div>
                                <div class="text-gray-500 text-xxs">Specs</div>
                            </div>
                        </div>
                        <div class="text-xs text-center text-gray-500 mt-3">All zones share VTI‚Ñ¢ trust ‚Ä¢ User-owned data ‚Ä¢ 100% auditable</div>
                    </div>

                    <!-- Trust Hierarchy Visualization -->
                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-purple-400">TRUST HIERARCHY</div>
                        <div class="flex items-center justify-between text-center">
                            <div class="flex-1">
                                <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center text-2xl mb-2 ${isL0 ? 'ring-4 ring-yellow-400' : ''}">L0</div>
                                <div class="text-xs text-yellow-400 font-bold">GOVERNANCE</div>
                                <div class="text-xs text-gray-500">Authoritative</div>
                            </div>
                            <div class="text-2xl text-gray-600">‚Üí</div>
                            <div class="flex-1">
                                <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-2xl mb-2 ${currentConfig.trustClass === 0 || currentConfig.trustClass === 1 ? 'ring-4 ring-purple-400' : ''}">L1</div>
                                <div class="text-xs text-purple-400 font-bold">KERNEL</div>
                                <div class="text-xs text-gray-500">Trusted</div>
                            </div>
                            <div class="text-2xl text-gray-600">‚Üí</div>
                            <div class="flex-1">
                                <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-2xl mb-2 ${currentConfig.trustClass >= 2 ? 'ring-4 ring-cyan-400' : ''}">L2</div>
                                <div class="text-xs text-cyan-400 font-bold">PROPOSER</div>
                                <div class="text-xs text-gray-500">Untrusted</div>
                            </div>
                        </div>
                        <div class="text-xs text-center text-gray-500 mt-3">Authority flows L0 ‚Üí L1 ‚Üí L2, NEVER upward (IV.01)</div>
                    </div>

                    <!-- Command Log -->
                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-sm font-bold text-green-400">COMMAND LOG</div>
                            <div class="text-xs text-gray-500 mono">${commandLog.length} total</div>
                        </div>
                        <div class="max-h-48 overflow-y-auto space-y-2">
                            ${recentCommands.length === 0 ? '<div class="text-center text-gray-500 py-4">No commands issued yet</div>' : recentCommands.map(cmd => `
                                <div class="glass rounded-lg p-2 border-l-2 border-yellow-500">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm">${cmd.typeInfo?.icon || '‚ö°'} ${cmd.description}</span>
                                        <span class="text-xs text-gray-500 mono">${new Date(cmd.timestamp).toLocaleTimeString()}</span>
                                    </div>
                                    <div class="text-xs text-gray-400 mt-1">${cmd.typeInfo?.label || cmd.type} ‚Ä¢ ${cmd.status}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg hover:opacity-90 transition font-medium">Close</button>
                `;
            }

            // L2 Proposal Queue Modal
            if (type === 'proposal-queue') {
                const pendingProposals = proposalQueue.filter(p => p.status === 'PENDING');
                const processedProposals = proposalQueue.filter(p => p.status !== 'PENDING').slice(0, 10);
                const isL0 = currentConfig.trustClass === -1;

                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üìã L2 PROPOSAL QUEUE</h2>
                    <p class="text-gray-400 text-sm mb-4">Untrusted proposals awaiting L0 authorization</p>

                    ${!isL0 ? `
                    <!-- Submit Proposal (Non-L0 Only) -->
                    <div class="glass-dark rounded-lg p-4 mb-4 border border-cyan-500/30">
                        <div class="text-sm font-bold mb-3 text-cyan-400">SUBMIT PROPOSAL</div>
                        <div class="space-y-3">
                            <input type="text" id="prop-title" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm" placeholder="Proposal title...">
                            <textarea id="prop-description" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm h-20" placeholder="Describe your proposal..."></textarea>
                            <div class="grid grid-cols-2 gap-3">
                                <select id="prop-category" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                    <option value="feature">Feature Request</option>
                                    <option value="config">Configuration Change</option>
                                    <option value="access">Access Request</option>
                                    <option value="data">Data Operation</option>
                                </select>
                                <button onclick="submitProposalFromModal()" class="py-2 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-lg text-sm font-medium hover:opacity-90 transition">
                                    Submit to L0
                                </button>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Pending Proposals -->
                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-sm font-bold text-yellow-400">PENDING APPROVAL</div>
                            <div class="text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-400">${pendingProposals.length}</div>
                        </div>
                        <div class="max-h-48 overflow-y-auto space-y-2">
                            ${pendingProposals.length === 0 ? '<div class="text-center text-gray-500 py-4">No pending proposals</div>' : pendingProposals.map(prop => `
                                <div class="glass rounded-lg p-3 border-l-2 border-yellow-500">
                                    <div class="flex items-center justify-between mb-1">
                                        <span class="text-sm font-medium">${prop.title}</span>
                                        <span class="text-xs text-gray-500 mono">${new Date(prop.timestamp).toLocaleDateString()}</span>
                                    </div>
                                    <div class="text-xs text-gray-400 mb-2">${prop.description?.slice(0, 100) || 'No description'}...</div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs px-2 py-1 rounded bg-white/10">${prop.proposer?.roleLabel || 'Unknown'}</span>
                                        ${isL0 ? `
                                        <div class="flex gap-2">
                                            <button onclick="approveProposal('${prop.id}'); showModal('proposal-queue');" class="px-3 py-1 bg-green-600 rounded text-xs hover:bg-green-700 transition">‚úì Approve</button>
                                            <button onclick="rejectProposal('${prop.id}'); showModal('proposal-queue');" class="px-3 py-1 bg-red-600 rounded text-xs hover:bg-red-700 transition">‚úó Reject</button>
                                        </div>
                                        ` : '<span class="text-xs text-yellow-400">Awaiting L0</span>'}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Processed Proposals -->
                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-gray-400">RECENT DECISIONS</div>
                        <div class="max-h-32 overflow-y-auto space-y-2">
                            ${processedProposals.length === 0 ? '<div class="text-center text-gray-500 py-2 text-xs">No processed proposals</div>' : processedProposals.map(prop => `
                                <div class="flex items-center justify-between text-xs p-2 rounded bg-white/5">
                                    <span>${prop.title}</span>
                                    <span class="${prop.status === 'APPROVED' ? 'text-green-400' : 'text-red-400'}">${prop.status}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-lg hover:opacity-90 transition font-medium">Close</button>
                `;
            }

            // User Profile Modal
            if (type === 'user-profile') {
                const role = JOB_ROLES[currentConfig.jobRole] || { label: 'Unknown', trustClass: 5 };
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üë§ USER PROFILE</h2>
                    <p class="text-gray-400 text-sm mb-6">ValidKernel‚Ñ¢ Identity & Trust Status</p>

                    <div class="text-center mb-6">
                        <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br ${currentConfig.trustClass === -1 ? 'from-yellow-400 to-orange-500' : 'from-purple-500 to-cyan-400'} flex items-center justify-center text-3xl mb-3">
                            ${currentConfig.trustClass === -1 ? 'L0' : role.label.charAt(0)}
                        </div>
                        <div class="text-xl font-bold ${role.color}">${role.label}</div>
                        <div class="text-sm text-gray-400">${role.description || 'System User'}</div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <div class="text-3xl font-bold mono ${currentConfig.trustClass === -1 ? 'text-yellow-400' : 'text-cyan-400'}">${currentConfig.trustClass}</div>
                                <div class="text-xs text-gray-400">Trust Class</div>
                            </div>
                            <div>
                                <div class="text-3xl font-bold mono text-purple-400">${role.level || 'L2'}</div>
                                <div class="text-xs text-gray-400">Authority Level</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-green-400">PERMISSIONS</div>
                        <div class="flex flex-wrap gap-2">
                            ${currentConfig.trustClass === -1 ?
                                '<span class="text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-400">ALL PERMISSIONS (L0)</span>' :
                                Object.entries(LAYER_ACCESS).filter(([id]) => canAccessLayer(id)).slice(0, 8).map(([id]) =>
                                    `<span class="text-xs px-2 py-1 rounded bg-purple-500/20 text-purple-400">${id}</span>`
                                ).join('')
                            }
                        </div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-cyan-400">SESSION INFO</div>
                        <div class="text-xs space-y-1 text-gray-400">
                            <div>Session: <span class="text-white mono">ACTIVE</span></div>
                            <div>Kernel: <span class="text-white mono">ValidKernel v1.0.0</span></div>
                            <div>VTI‚Ñ¢: <span class="text-green-400 mono">ENABLED</span></div>
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Close</button>
                `;
            }

            // Notifications Modal
            if (type === 'notifications') {
                const recentAudit = auditLog.slice(0, 10);
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üîî NOTIFICATIONS</h2>
                    <p class="text-gray-400 text-sm mb-4">Recent system activity and alerts</p>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-3 text-purple-400">RECENT ACTIVITY</div>
                        <div class="max-h-64 overflow-y-auto space-y-2">
                            ${recentAudit.length === 0 ? '<div class="text-center text-gray-500 py-4">No recent activity</div>' : recentAudit.map(entry => `
                                <div class="flex items-start gap-3 p-2 rounded bg-white/5 hover:bg-white/10 transition">
                                    <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-sm">
                                        ${entry.action.includes('COMMAND') ? '‚ö°' : entry.action.includes('PROPOSAL') ? 'üìã' : entry.action.includes('CREATE') ? '‚ú®' : 'üìå'}
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-sm">${entry.action.replace(/_/g, ' ')}</div>
                                        <div class="text-xs text-gray-500">${new Date(entry.timestamp).toLocaleString()}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Close</button>
                `;
            }

            // Campaign Detail Modal
            if (type === 'campaign-detail') {
                const campaign = data.campaigns.find(c => c.id === itemId) || data.campaigns[0];
                if (campaign) {
                    content.innerHTML = `
                        <h2 class="text-xl font-bold mono mb-2">üìä CAMPAIGN DETAILS</h2>
                        <p class="text-gray-400 text-sm mb-4">${campaign.name}</p>

                        <div class="glass-dark rounded-lg p-4 mb-4">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Campaign Name</label>
                                    <input type="text" id="edit-campaign-name" value="${campaign.name}" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Type</label>
                                    <select id="edit-campaign-type" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="email" ${campaign.type === 'email' ? 'selected' : ''}>Email</option>
                                        <option value="sms" ${campaign.type === 'sms' ? 'selected' : ''}>SMS</option>
                                        <option value="social" ${campaign.type === 'social' ? 'selected' : ''}>Social</option>
                                        <option value="multi-channel" ${campaign.type === 'multi-channel' ? 'selected' : ''}>Multi-Channel</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-xs text-gray-400 mb-1">Status</label>
                                <select id="edit-campaign-status" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                    <option value="draft" ${campaign.status === 'draft' ? 'selected' : ''}>Draft</option>
                                    <option value="active" ${campaign.status === 'active' ? 'selected' : ''}>Active</option>
                                    <option value="paused" ${campaign.status === 'paused' ? 'selected' : ''}>Paused</option>
                                    <option value="completed" ${campaign.status === 'completed' ? 'selected' : ''}>Completed</option>
                                </select>
                            </div>
                        </div>

                        <div class="glass-dark rounded-lg p-4 mb-4">
                            <div class="text-sm font-bold mb-3 text-purple-400">PERFORMANCE</div>
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div>
                                    <div class="text-2xl font-bold text-cyan-400">${(campaign.sent || 0).toLocaleString()}</div>
                                    <div class="text-xs text-gray-500">Sent</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-green-400">${(campaign.opens || 0).toLocaleString()}</div>
                                    <div class="text-xs text-gray-500">Opens</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-purple-400">${(campaign.clicks || 0).toLocaleString()}</div>
                                    <div class="text-xs text-gray-500">Clicks</div>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button onclick="updateCampaign(${campaign.id})" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Save Changes</button>
                        </div>
                    `;
                }
            }

            // Contact Detail Modal
            if (type === 'contact-detail') {
                const contact = data.leads.find(l => l.id === itemId) || data.leads[0];
                if (contact) {
                    content.innerHTML = `
                        <h2 class="text-xl font-bold mono mb-2">üë§ CONTACT DETAILS</h2>
                        <p class="text-gray-400 text-sm mb-4">${contact.name || contact.email}</p>

                        <div class="glass-dark rounded-lg p-4 mb-4">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Name</label>
                                    <input type="text" id="edit-contact-name" value="${contact.name || ''}" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Email</label>
                                    <input type="email" id="edit-contact-email" value="${contact.email || ''}" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Company</label>
                                    <input type="text" id="edit-contact-company" value="${contact.company || ''}" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Stage</label>
                                    <select id="edit-contact-stage" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="new" ${contact.stage === 'new' ? 'selected' : ''}>New</option>
                                        <option value="contacted" ${contact.stage === 'contacted' ? 'selected' : ''}>Contacted</option>
                                        <option value="qualified" ${contact.stage === 'qualified' ? 'selected' : ''}>Qualified</option>
                                        <option value="proposal" ${contact.stage === 'proposal' ? 'selected' : ''}>Proposal</option>
                                        <option value="won" ${contact.stage === 'won' ? 'selected' : ''}>Won</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Lead Score</label>
                                <div class="flex items-center gap-3">
                                    <input type="range" id="edit-contact-score" min="0" max="100" value="${contact.score || 0}" class="flex-1">
                                    <span class="mono text-cyan-400" id="score-display">${contact.score || 0}</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <button onclick="deleteContact(${contact.id})" class="py-3 px-6 border border-red-500/50 text-red-400 rounded-lg hover:bg-red-500/20 transition">Delete</button>
                            <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button onclick="updateContact(${contact.id})" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Save</button>
                        </div>
                    `;
                    document.getElementById('edit-contact-score')?.addEventListener('input', (e) => {
                        document.getElementById('score-display').textContent = e.target.value;
                    });
                }
            }

            // New Lead Modal
            if (type === 'new-lead') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">‚ûï CAPTURE LEAD</h2>
                    <p class="text-gray-400 text-sm mb-4">Add a new lead to your pipeline</p>

                    <form onsubmit="createLead(event)">
                        <div class="glass-dark rounded-lg p-4 mb-4">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Name *</label>
                                    <input type="text" id="lead-name" required class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Email *</label>
                                    <input type="email" id="lead-email" required class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Company</label>
                                    <input type="text" id="lead-company" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Source</label>
                                    <select id="lead-source" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="website">Website</option>
                                        <option value="referral">Referral</option>
                                        <option value="social">Social Media</option>
                                        <option value="event">Event</option>
                                        <option value="outbound">Outbound</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button type="submit" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Create Lead</button>
                        </div>
                    </form>
                `;
            }

            // Integration Setup Modal
            if (type === 'integration-setup') {
                const integrations = [
                    { id: 'salesforce', name: 'Salesforce', icon: '‚òÅÔ∏è', connected: false, description: 'Sync contacts and opportunities' },
                    { id: 'hubspot', name: 'HubSpot', icon: 'üü†', connected: false, description: 'Connect CRM and marketing data' },
                    { id: 'zapier', name: 'Zapier', icon: '‚ö°', connected: false, description: 'Automate with 5,000+ apps' },
                    { id: 'sheets', name: 'Google Sheets', icon: 'üìä', connected: true, description: 'Import/export data to sheets' },
                    { id: 'slack', name: 'Slack', icon: 'üí¨', connected: false, description: 'Get notifications in Slack' },
                    { id: 'mailchimp', name: 'Mailchimp', icon: 'üêµ', connected: false, description: 'Sync email lists' }
                ];

                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üîó INTEGRATIONS</h2>
                    <p class="text-gray-400 text-sm mb-4">Connect vkMRKTos to your favorite tools</p>

                    <div class="space-y-3 mb-6 max-h-80 overflow-y-auto">
                        ${integrations.map(int => `
                            <div class="glass-dark rounded-lg p-4 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="text-2xl">${int.icon}</div>
                                    <div>
                                        <div class="font-medium">${int.name}</div>
                                        <div class="text-xs text-gray-500">${int.description}</div>
                                    </div>
                                </div>
                                <button onclick="toggleIntegration('${int.id}')" class="${int.connected ? 'bg-green-600' : 'bg-white/10 border border-white/20'} px-4 py-2 rounded-lg text-sm transition hover:opacity-80">
                                    ${int.connected ? '‚úì Connected' : 'Connect'}
                                </button>
                            </div>
                        `).join('')}
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-2 text-purple-400">API KEYS</div>
                        <div class="flex gap-2">
                            <input type="text" placeholder="Enter API key..." class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm mono">
                            <button class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm transition">Save Key</button>
                        </div>
                    </div>

                    <button onclick="closeModal()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Done</button>
                `;
            }

            // New A/B Test Modal
            if (type === 'new-test') {
                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üß™ CREATE A/B TEST</h2>
                    <p class="text-gray-400 text-sm mb-4">Set up a new experiment</p>

                    <form onsubmit="createABTest(event)">
                        <div class="glass-dark rounded-lg p-4 mb-4">
                            <div class="mb-4">
                                <label class="block text-xs text-gray-400 mb-1">Test Name *</label>
                                <input type="text" id="test-name" required placeholder="e.g., Homepage CTA Color Test" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Test Type</label>
                                    <select id="test-type" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="subject">Subject Line</option>
                                        <option value="content">Email Content</option>
                                        <option value="cta">CTA Button</option>
                                        <option value="timing">Send Time</option>
                                        <option value="landing">Landing Page</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Variants</label>
                                    <select id="test-variants" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="2">2 Variants (A/B)</option>
                                        <option value="3">3 Variants (A/B/C)</option>
                                        <option value="4">4 Variants (A/B/C/D)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Variant A</label>
                                    <input type="text" id="variant-a" placeholder="Control version" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Variant B</label>
                                    <input type="text" id="variant-b" placeholder="Test version" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                            </div>
                        </div>

                        <div class="glass-dark rounded-lg p-4 mb-4">
                            <div class="text-sm font-bold mb-2 text-purple-400">TEST SETTINGS</div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Sample Size (%)</label>
                                    <input type="number" id="test-sample" value="20" min="5" max="100" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-400 mb-1">Win Metric</label>
                                    <select id="test-metric" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-sm">
                                        <option value="opens">Open Rate</option>
                                        <option value="clicks">Click Rate</option>
                                        <option value="conversions">Conversions</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <button type="button" onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Cancel</button>
                            <button type="submit" class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Create Test</button>
                        </div>
                    </form>
                `;
            }

            // Test Detail Modal
            if (type === 'test-detail') {
                const test = data.tests?.find(t => t.id === itemId) || {
                    name: 'Subject Line Test',
                    status: 'running',
                    variantA: { name: 'Control', conversions: 145, sent: 500 },
                    variantB: { name: 'Test', conversions: 187, sent: 500 }
                };
                const convA = ((test.variantA?.conversions / test.variantA?.sent) * 100 || 0).toFixed(1);
                const convB = ((test.variantB?.conversions / test.variantB?.sent) * 100 || 0).toFixed(1);
                const winner = convB > convA ? 'B' : 'A';

                content.innerHTML = `
                    <h2 class="text-xl font-bold mono mb-2">üß™ TEST RESULTS</h2>
                    <p class="text-gray-400 text-sm mb-4">${test.name}</p>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="glass-dark rounded-lg p-4 ${winner === 'A' ? 'ring-2 ring-green-500' : ''}">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-bold">Variant A</span>
                                ${winner === 'A' ? '<span class="text-green-400 text-sm">üëë Winner</span>' : ''}
                            </div>
                            <div class="text-3xl font-bold text-cyan-400 mb-1">${convA}%</div>
                            <div class="text-xs text-gray-500">${test.variantA?.conversions || 0} / ${test.variantA?.sent || 0} conversions</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4 ${winner === 'B' ? 'ring-2 ring-green-500' : ''}">
                            <div class="flex items-center justify-between mb-3">
                                <span class="font-bold">Variant B</span>
                                ${winner === 'B' ? '<span class="text-green-400 text-sm">üëë Winner</span>' : ''}
                            </div>
                            <div class="text-3xl font-bold text-purple-400 mb-1">${convB}%</div>
                            <div class="text-xs text-gray-500">${test.variantB?.conversions || 0} / ${test.variantB?.sent || 0} conversions</div>
                        </div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 mb-4">
                        <div class="text-sm font-bold mb-2 text-purple-400">STATISTICAL SIGNIFICANCE</div>
                        <div class="flex items-center gap-3">
                            <div class="flex-1 bg-white/10 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 95%"></div>
                            </div>
                            <span class="mono text-green-400">95%</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">Results are statistically significant</div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 py-3 border border-white/20 rounded-lg hover:bg-white/10 transition">Close</button>
                        <button onclick="applyWinner('${winner}')" class="flex-1 py-3 bg-gradient-to-r from-green-600 to-cyan-600 rounded-lg hover:opacity-90 transition font-medium">Apply Winner</button>
                    </div>
                `;
            }

            overlay.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        // Helper function to execute L0 command from modal
        function executeCommandFromModal() {
            const type = document.getElementById('cmd-type')?.value;
            const description = document.getElementById('cmd-description')?.value;

            if (!description) {
                showToast('Please enter a command description', 'error');
                return;
            }

            issueL0Command(type, description, { source: 'modal' });
            showModal('command-center'); // Refresh the modal
        }

        // Helper function to submit L2 proposal from modal
        function submitProposalFromModal() {
            const title = document.getElementById('prop-title')?.value;
            const description = document.getElementById('prop-description')?.value;
            const category = document.getElementById('prop-category')?.value;

            if (!title) {
                showToast('Please enter a proposal title', 'error');
                return;
            }

            submitL2Proposal(title, description, category, 'Pending L0 review');
            showModal('proposal-queue'); // Refresh the modal
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const colors = { success: 'bg-green-600', error: 'bg-red-600', info: 'bg-purple-600' };
            const toast = document.createElement('div');
            toast.className = `${colors[type]} px-6 py-3 rounded-lg shadow-lg text-sm font-medium animate-pulse`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function createCampaign(e) {
            e.preventDefault();
            const name = document.getElementById('campaign-name').value;
            const type = document.getElementById('campaign-type').value;
            data.campaigns.unshift({ id: Date.now(), name, type, status: 'draft', sent: 0, opens: 0, clicks: 0 });
            saveData(true);
            logAudit('CAMPAIGN_CREATE', { name, type }, 'IV.04');
            closeModal();
            renderCampaigns('campaign-list', 4);
            showToast(`Campaign "${name}" created`);
        }

        // v2.0 - Create Segment
        function createSegment(e) {
            e.preventDefault();
            const name = document.getElementById('segment-name').value;
            const type = document.getElementById('segment-type').value;
            const field = document.getElementById('segment-field').value;
            const op = document.getElementById('segment-op').value;
            const value = document.getElementById('segment-value').value;

            data.segments.unshift({
                id: Date.now(),
                name,
                type,
                conditions: [{ field, op, value }],
                count: 0,
                color: ['purple', 'blue', 'green', 'cyan', 'red'][Math.floor(Math.random() * 5)]
            });

            saveData(true);
            logAudit('SEGMENT_CREATE', { name, type, conditions: `${field} ${op} ${value}` }, 'IV.04');
            closeModal();
            showToast(`Segment "${name}" created`);
            if (document.getElementById('content-segmentation')?.classList.contains('hidden') === false) {
                renderSegments();
            }
        }

        // v2.0 - Create Scoring Rule
        function createScoringRule(e) {
            e.preventDefault();
            const name = document.getElementById('rule-name').value;
            const action = document.getElementById('rule-action').value;
            const points = parseInt(document.getElementById('rule-points').value);
            const decay = parseInt(document.getElementById('rule-decay').value);

            data.scoringRules.push({
                id: Date.now(),
                name,
                action,
                points,
                decay,
                active: true
            });

            saveData(true);
            logAudit('SCORING_RULE_CREATE', { name, action, points }, 'IV.04');
            closeModal();
            showToast(`Scoring rule "${name}" added (+${points} points)`);
            if (document.getElementById('content-scoring')?.classList.contains('hidden') === false) {
                renderScoringRules();
            }
        }

        // v2.3 - Update Campaign
        function updateCampaign(id) {
            const campaign = data.campaigns.find(c => c.id === id);
            if (!campaign) return;

            campaign.name = document.getElementById('edit-campaign-name').value;
            campaign.type = document.getElementById('edit-campaign-type').value;
            campaign.status = document.getElementById('edit-campaign-status').value;

            saveData(true);
            logAudit('CAMPAIGN_UPDATE', { id, name: campaign.name }, 'IV.04');
            closeModal();
            showToast(`Campaign "${campaign.name}" updated`);
            refreshAllViews();
        }

        // v2.3 - Update Contact
        function updateContact(id) {
            const contact = data.leads.find(l => l.id === id);
            if (!contact) return;

            contact.name = document.getElementById('edit-contact-name').value;
            contact.email = document.getElementById('edit-contact-email').value;
            contact.company = document.getElementById('edit-contact-company').value;
            contact.stage = document.getElementById('edit-contact-stage').value;
            contact.score = parseInt(document.getElementById('edit-contact-score').value);

            saveData(true);
            logAudit('CONTACT_UPDATE', { id, name: contact.name }, 'IV.04');
            closeModal();
            showToast(`Contact "${contact.name}" updated`);
            refreshAllViews();
        }

        // v2.3 - Delete Contact
        function deleteContact(id) {
            const contact = data.leads.find(l => l.id === id);
            if (!contact) return;

            if (confirm(`Delete contact "${contact.name || contact.email}"? This cannot be undone.`)) {
                data.leads = data.leads.filter(l => l.id !== id);
                saveData(true);
                logAudit('CONTACT_DELETE', { id, name: contact.name }, 'IV.02');
                closeModal();
                showToast(`Contact deleted`);
                refreshAllViews();
            }
        }

        // v2.3 - Create Lead
        function createLead(e) {
            e.preventDefault();
            const name = document.getElementById('lead-name').value;
            const email = document.getElementById('lead-email').value;
            const company = document.getElementById('lead-company').value;
            const source = document.getElementById('lead-source').value;

            data.leads.unshift({
                id: Date.now(),
                name,
                email,
                company,
                source,
                stage: 'new',
                score: 10,
                createdAt: new Date().toISOString()
            });

            saveData(true);
            logAudit('LEAD_CREATE', { name, email, source }, 'IV.04');
            closeModal();
            showToast(`Lead "${name}" captured`);
            refreshAllViews();
        }

        // v2.3 - Toggle Integration
        function toggleIntegration(integrationId) {
            // In a real app, this would initiate OAuth or API key configuration
            logAudit('INTEGRATION_TOGGLE', { integration: integrationId }, 'IV.03');
            showToast(`${integrationId} integration toggled. Configure API keys to connect.`, 'info');
        }

        // v2.3 - Create A/B Test
        function createABTest(e) {
            e.preventDefault();
            const name = document.getElementById('test-name').value;
            const type = document.getElementById('test-type').value;
            const variants = document.getElementById('test-variants').value;
            const variantA = document.getElementById('variant-a').value || 'Control';
            const variantB = document.getElementById('variant-b').value || 'Test';
            const sample = document.getElementById('test-sample').value;
            const metric = document.getElementById('test-metric').value;

            if (!data.tests) data.tests = [];

            data.tests.unshift({
                id: Date.now(),
                name,
                type,
                variants: parseInt(variants),
                variantA: { name: variantA, conversions: 0, sent: 0 },
                variantB: { name: variantB, conversions: 0, sent: 0 },
                sampleSize: parseInt(sample),
                winMetric: metric,
                status: 'draft',
                createdAt: new Date().toISOString()
            });

            saveData(true);
            logAudit('TEST_CREATE', { name, type }, 'IV.04');
            closeModal();
            showToast(`A/B Test "${name}" created`);
        }

        // v2.3 - Apply Winning Variant
        function applyWinner(variant) {
            logAudit('TEST_WINNER_APPLIED', { variant }, 'IV.02');
            closeModal();
            showToast(`Variant ${variant} applied to all traffic`, 'success');
        }

        // v2.0 - Render Segments
        function renderSegments() {
            const container = document.getElementById('segments-grid');
            if (!container) return;

            const colorClasses = {
                purple: 'border-purple-500/50 bg-purple-500/10',
                blue: 'border-blue-500/50 bg-blue-500/10',
                green: 'border-green-500/50 bg-green-500/10',
                cyan: 'border-cyan-500/50 bg-cyan-500/10',
                red: 'border-red-500/50 bg-red-500/10'
            };

            container.innerHTML = data.segments.map(s => `
                <div class="glass-dark rounded-lg p-4 border-l-4 ${colorClasses[s.color] || 'border-white/20'}">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium">${s.name}</span>
                        <span class="text-xs px-2 py-1 rounded ${s.type === 'dynamic' ? 'bg-cyan-500/20 text-cyan-400' : 'bg-gray-500/20 text-gray-400'}">${s.type}</span>
                    </div>
                    <div class="text-2xl font-bold mono mb-2">${s.count}</div>
                    <div class="text-xs text-gray-400">${s.conditions.length > 0 ? s.conditions.map(c => `${c.field} ${c.op} ${c.value}`).join(', ') : 'Manual list'}</div>
                </div>
            `).join('');
        }

        // v2.0 - Render Scoring Rules
        function renderScoringRules() {
            const container = document.getElementById('scoring-rules');
            if (!container) return;

            container.innerHTML = data.scoringRules.map(r => `
                <div class="glass-dark rounded-lg p-4 flex items-center justify-between">
                    <div>
                        <div class="font-medium">${r.name}</div>
                        <div class="text-xs text-gray-400">${r.action} ‚Ä¢ Decay: ${r.decay > 0 ? r.decay + ' days' : 'Never'}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl font-bold mono ${r.points >= 20 ? 'text-green-400' : r.points >= 10 ? 'text-cyan-400' : 'text-gray-400'}">+${r.points}</div>
                        <div class="text-xs ${r.active ? 'text-green-400' : 'text-gray-500'}">${r.active ? 'Active' : 'Paused'}</div>
                    </div>
                </div>
            `).join('');
        }

        // v2.0 - Render Journeys
        function renderJourneys() {
            const container = document.getElementById('journeys-grid');
            if (!container) return;

            container.innerHTML = data.journeys.map(j => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-xs px-2 py-1 rounded ${j.status === 'active' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}">${j.status}</span>
                        <span class="text-xs text-gray-400 mono">${j.steps} steps</span>
                    </div>
                    <div class="font-medium mb-3">${j.name}</div>
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div><div class="text-gray-400">Enrolled</div><div class="mono text-white">${j.enrolled}</div></div>
                        <div><div class="text-gray-400">Completed</div><div class="mono text-white">${j.completed}</div></div>
                        <div><div class="text-gray-400">Conversion</div><div class="mono ${j.conversionRate >= 50 ? 'text-green-400' : 'text-yellow-400'}">${j.conversionRate}%</div></div>
                    </div>
                </div>
            `).join('');
        }

        // v2.0 - Render Revenue
        function renderRevenue() {
            const container = document.getElementById('revenue-stats');
            if (!container) return;

            container.innerHTML = `
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-xs text-gray-400 uppercase mb-2">MTD Revenue</div>
                        <div class="text-3xl font-bold mono text-green-400">$${(data.revenue.mtd / 1000).toFixed(0)}K</div>
                        <div class="text-xs text-green-400 mt-1">+${((data.revenue.mtd / data.revenue.lastMonth - 1) * 100).toFixed(0)}% vs last</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-xs text-gray-400 uppercase mb-2">YTD Revenue</div>
                        <div class="text-3xl font-bold mono text-purple-400">$${(data.revenue.ytd / 1000).toFixed(0)}K</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-xs text-gray-400 uppercase mb-2">Pipeline</div>
                        <div class="text-3xl font-bold mono text-cyan-400">$${(data.revenue.pipeline / 1000).toFixed(0)}K</div>
                    </div>
                    <div class="glass rounded-xl p-6 text-center">
                        <div class="text-xs text-gray-400 uppercase mb-2">Deals</div>
                        <div class="text-3xl font-bold mono text-white">${data.revenue.deals.length}</div>
                    </div>
                </div>
                <div class="glass-dark rounded-lg p-4">
                    <h3 class="text-sm font-bold mb-4 text-purple-400">TOP DEALS</h3>
                    ${data.revenue.deals.map(d => `
                        <div class="flex items-center justify-between py-3 border-b border-white/5 last:border-0">
                            <div>
                                <div class="font-medium">${d.name}</div>
                                <div class="text-xs text-gray-400">${d.stage}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold mono">$${(d.value / 1000).toFixed(0)}K</div>
                                <div class="text-xs text-green-400">${d.probability}% probability</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // v2.0 - Render Identity (Contacts)
        function renderIdentity() {
            const container = document.getElementById('identity-contacts');
            if (!container) return;

            container.innerHTML = data.leads.map(l => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center font-bold">${l.name.charAt(0)}</div>
                        <div>
                            <div class="font-medium">${l.name}</div>
                            <div class="text-xs text-gray-400">${l.company}</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-400 space-y-1">
                        <div>üìß ${l.email || 'No email'}</div>
                        <div>üìû ${l.phone || 'No phone'}</div>
                    </div>
                    <div class="flex gap-2 mt-3">
                        ${(l.tags || []).map(t => `<span class="text-xs px-2 py-1 rounded bg-purple-500/20 text-purple-400">${t}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INITIALIZATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        document.addEventListener('DOMContentLoaded', () => {
            // Load audit log first (before any other operations)
            loadAuditLog();

            // Load ValidKernel‚Ñ¢ Command Authorization System
            loadCommandLog();
            loadProposalQueue();

            // Load saved data
            loadData();

            // Load user config (roles, access control)
            loadConfig();

            // Set default to SUPER_ADMIN if no config exists
            if (!localStorage.getItem(CONFIG_KEY)) {
                currentConfig.jobRole = 'super_admin';
                currentConfig.trustClass = -1;
                saveConfig();
            }

            // Check for shared data in URL
            loadFromShareLink();

            // Render all views
            renderGenomeGrid();
            renderCampaigns('campaign-list', 4);
            renderPipeline('pipeline-stages');
            renderWorkflows('workflow-grid', 4);
            renderActivityFeed();

            // Update trust score display
            updateTrustScore();

            // Update Command Center UI
            updateCommandCenterUI();

            // Update role display
            updateRoleDisplay();

            // Log session start
            logAudit('SESSION_START', { version: MARKTOS_VERSION, vti_enabled: true, role: currentConfig.jobRole }, 'IV.01');

            console.log('[MARKTOS] Kernel v' + MARKTOS_VERSION + ' initialized');
            console.log('[MARKTOS] VTI‚Ñ¢ (Verifiable Trust Infrastructure) ENABLED');
            console.log('[MARKTOS] ValidKernel‚Ñ¢ Command Authorization System ACTIVE');
            console.log('[MARKTOS] Current Role:', JOB_ROLES[currentConfig.jobRole]?.label || currentConfig.jobRole);
            console.log('[MARKTOS] Trust Class:', currentConfig.trustClass);
            console.log('[MARKTOS] 25-layer genome active');
            console.log('[MARKTOS] Trust Score:', calculateTrustScore());

            // PWA Install Prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('install-hint').style.display = 'block';
                document.getElementById('install-hint').onclick = () => {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((result) => {
                        if (result.outcome === 'accepted') {
                            showToast('MARKTOS installed!', 'success');
                        }
                        deferredPrompt = null;
                        document.getElementById('install-hint').style.display = 'none';
                    });
                };
            });

            // Register Service Worker for offline support
            if ('serviceWorker' in navigator) {
                // Inline service worker via blob
                const swCode = `
                    const CACHE_NAME = 'marktos-v${MARKTOS_VERSION}';
                    self.addEventListener('install', e => self.skipWaiting());
                    self.addEventListener('activate', e => e.waitUntil(clients.claim()));
                    self.addEventListener('fetch', e => {
                        if (e.request.url.includes('cdn.tailwindcss.com') || e.request.url.includes('fonts.googleapis.com')) {
                            e.respondWith(caches.match(e.request).then(r => r || fetch(e.request).then(res => {
                                const clone = res.clone();
                                caches.open(CACHE_NAME).then(cache => cache.put(e.request, clone));
                                return res;
                            })));
                        }
                    });
                `;
                const swBlob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(swBlob);
                navigator.serviceWorker.register(swUrl).then(() => {
                    console.log('[MARKTOS] Service Worker registered');
                }).catch(() => {
                    console.log('[MARKTOS] Service Worker not supported in this context');
                });
            }
        });

        // Close modal on overlay click
        document.getElementById('modal-overlay').addEventListener('click', e => {
            if (e.target.id === 'modal-overlay') closeModal();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
        });
    </script>

</body>
</html>
